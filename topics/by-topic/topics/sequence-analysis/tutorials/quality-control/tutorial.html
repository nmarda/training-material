<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Quality Control</title>
        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-45719423-18' , 'auto');
            ga('send', 'pageview');
        </script>
        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <link rel="stylesheet" href="/training-material/assets/css/font-awesome.css">
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

        
        
        
        
        
        <meta name="description" content="Analyses of sequences" />
        <meta property="og:title" content="Galaxy Training: Quality Control" />
        <meta property="og:description" content="Analyses of sequences" />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        











<header>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/sequence-analysis" title="Go back to list of tutorials">
                            <i class="fa fa-folder-o" aria-hidden="true"></i><span class="visually-hidden">topic</span> Sequence analysis
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="EN">
                            EN
                        </a>
                        <div class="dropdown-menu">
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fsequence-analysis%2Ftutorials%2Fquality-control%2Ftutorial.html&edit-text=&act=url" title="">
                                FR
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fsequence-analysis%2Ftutorials%2Fquality-control%2Ftutorial.html&edit-text=&act=url" title="">
                                JA
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fsequence-analysis%2Ftutorials%2Fquality-control%2Ftutorial.html&edit-text=&act=url" title="">
                                ES
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fsequence-analysis%2Ftutorials%2Fquality-control%2Ftutorial.html&edit-text=&act=url" title="">
                                PT
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fsequence-analysis%2Ftutorials%2Fquality-control%2Ftutorial.html&edit-text=&act=url" title="">
                                AR
                            </a>
                            
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="fa fa-life-ring" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>

        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQ">
            FAQ
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Chat on Gitter">
            Chat on Gitter
        </a>
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            Discuss on Galaxy Help
        </a>
    </div>
</li>


                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/sequence-analysis/tutorials/quality-control/tutorial.md">
                            <i class="fa fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="container main-content">
    <script type="application/ld+json">
        


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Quality Control",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "/blob//LICENSE.md",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "courseCode": "sequence-analysis / quality-control / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Quality Control' tutorial",
  "isPartOf": {
    "@type": "Course",
    "name": "Quality Control",
    "description": "Quality Control",
    "learningResourceType": "tutorial",
    "interactivityType": "expositive",
    "provider": {
      "@type": "Organization",
      "email": "galaxytrainingnetwork@gmail.com",
      "name": "Galaxy Training Network",
      "url": "https://galaxyproject.org/teach/gtn/"
    }
  },
  "url": "https://galaxyproject.github.io//training-material/topics/sequence-analysis/tutorials/quality-control/tutorial.html",
  "timeRequired": "PT1H",
  "description": "Quality Control\\nThe questions this  addresses are:\n - How to perform quality control of NGS raw data (FASTQ)?\n - What are the quality parameters to check for a dataset?\n - How to improve the quality of a dataset?\n\n\\nThe objectives are:\n - Manipulate FASTQ files\n - Assess quality from a FASTQ file\n - Use FastQC tool\n - Understand FastQC output\n - Use tools for quality correction\n - Use a tool to aggregate FastQC output\n - Process single-end and paired-end data\n\n",
  "coursePrerequisites": [
    {
      "@type": "CreativeWork",
      "url": "https://galaxyproject.github.io//training-material/topics/introduction/",
      "name": "Introduction to Galaxy Analyses",
      "description": "Introduction to Galaxy Analyses",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "hasPart": [

  ],
  "mentions": [
    {
      "@type": "Thing",
      "url": "https://doi.org/10.5281/zenodo.61771",
      "name": "Training data for Quality Control tutorial"
    }
  ],
  "author": [
    {
      "@type": "Person",
      "name": "Bérénice Batut"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Bérénice Batut"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Sequence analysis",
      "description": "Analyses of sequences",
      "url": "https://galaxyproject.github.io//training-material/topics/sequence-analysis/"
    }
  ]
}
    </script>

    <section class="tutorial">
        <h1 data-toc-skip>Quality Control</h1>
        <div class="contributors-line">By: 

<a href="/training-material/hall-of-fame#bebatut" class="contributor-badge"><img src="https://avatars.githubusercontent.com/bebatut" alt="Bérénice Batut">Bérénice Batut</a>

</div>
        <blockquote class="overview">
            <h3>Overview</h3>
            <strong><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</strong>
            <ul>
            
            <li>How to perform quality control of NGS raw data (FASTQ)?</li>
            
            <li>What are the quality parameters to check for a dataset?</li>
            
            <li>How to improve the quality of a dataset?</li>
            
            </ul>

            <strong><i class="fa fa-bullseye" aria-hidden="true"></i><span class="visually-hidden">objectives</span> Objectives</strong>
            <ul>
            
            <li>Manipulate FASTQ files</li>
            
            <li>Assess quality from a FASTQ file</li>
            
            <li>Use FastQC tool</li>
            
            <li>Understand FastQC output</li>
            
            <li>Use tools for quality correction</li>
            
            <li>Use a tool to aggregate FastQC output</li>
            
            <li>Process single-end and paired-end data</li>
            
            </ul>

            
            <strong><i class="fa fa-check-circle" aria-hidden="true"></i><span class="visually-hidden">requirements</span> Requirements</strong>
            <ul>
            
    <li>
    
        
        
        <a href="/training-material/topics/introduction">Introduction to Galaxy Analyses</a>
        
    
    </li>

            
            </ul>
            

            
            <p><strong><i class="fa fa-hourglass-end" aria-hidden="true"></i><span class="visually-hidden">time</span> Time estimation:</strong> 1 hour</p>
            

            



            <div>
                <div><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials</strong></div>
                <div id="supporting_materials">
                    <ul>
                        <li>
                            <div>
                    
                    <div>
                        <a class="topic-icon" href="/training-material/topics/sequence-analysis/tutorials/quality-control/slides.html" title="Slides for this tutorial">
                            <i class="fa fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> Slides
                        </a>
                    </div>
                    

                    
                    <div>
                        
<a class="topic-icon" href="https://doi.org/10.5281/zenodo.61771">
    <i class="fa fa-files-o" aria-hidden="true"></i><span class="visually-hidden">zenodo_link</span> Datasets
</a>


                    </div>
                    

                    
                    <div>
                        
    <a class="topic-icon" href="https://github.com/galaxyproject/training-material/tree/master/topics/sequence-analysis/tutorials/quality-control/workflows/" title="Workflows" alt="Quality Control workflows">
        <i class="fa fa-share-alt" aria-hidden="true"></i><span class="visually-hidden">workflow</span> Workflows
    </a>


                    </div>
                    
                    
                    <div>
                        
<a class="topic-icon" href="https://github.com/galaxyproject/training-material/tree/master/topics/sequence-analysis/tutorials/quality-control/tours/">
    <i class="fa fa-magic" aria-hidden="true"></i><span class="visually-hidden">interactive_tour</span> Tours
</a>


                    </div>
                    


                    
                    
                    <div>
                        

    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Where to run the tutorial">
        <i class="fa fa-cog" aria-hidden="true"></i><span class="visually-hidden">instances</span> Galaxies
    </a>
    <ul class="dropdown-menu">
    
        <li>
            <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/tree/master/topics/sequence-analysis/docker" title="Docker image for this tutorial">
                <i class="fa fa-ship" aria-hidden="true"></i><span class="visually-hidden">docker_image</span> Docker image
            </a>
        </li>
    
    
    </ul>



                    </div>
                    
                    
                            </div>
                        </li>
                    </ul>
                </div>

            </div>

        </blockquote>

        <div class="container">
            <div class="row">
                <!-- sidebar, which will move to the top on a small screen -->
                <div class="col-sm-2">
                    <nav id="toc" data-toggle="toc" class="sticky-top"></nav>
                </div>
                <div class="col-sm-10">
                    <h1 class="no_toc" id="introduction">Introduction</h1>

<p>During sequencing, the nucleotide bases in a DNA or RNA sample (library) are determined by the sequencer. For each fragment in the library, a short sequence is generated, also called a <strong>read</strong>, which is simply a succession of nucleotides</p>

<p>Modern sequencing technologies can generate a massive number of sequence reads in a single experiment. However, no sequencing technology is perfect, and each instrument will generate different types and amounts of error, such as incorrect nucleotides being called. These are due to the technical limitations of each sequencing platform.</p>

<p>Therefore, it is necessary to understand, identify and exclude error-types that may impact the interpretation of downstream analysis.
Sequence quality control is therefore an essential first step in your analysis. Catching errors early saves time later on.</p>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

  <p>In this tutorial, we will deal with:</p>

<ol id="markdown-toc">
  <li><a href="#inspect-a-raw-sequence-file" id="markdown-toc-inspect-a-raw-sequence-file">Inspect a raw sequence file</a></li>
  <li><a href="#assess-the-read-quality" id="markdown-toc-assess-the-read-quality">Assess the Read Quality</a></li>
  <li><a href="#filter-and-trim" id="markdown-toc-filter-and-trim">Filter and Trim</a></li>
  <li><a href="#process-paired-end-data" id="markdown-toc-process-paired-end-data">Process paired-end data</a></li>
</ol>

</blockquote>

<h1 id="inspect-a-raw-sequence-file">Inspect a raw sequence file</h1>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-data-upload"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Data upload</h3>

  <ol>
    <li>
      <p>Create a new history for this tutorial and give it a proper name</p>

      <blockquote class="tip">

        <h3 id="tip-tip-creating-a-new-history"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Creating a new history</h3>

        <p>Click the <i class="fa fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> icon at the top of the history panel</p>

        <p>If the <i class="fa fa-plus" aria-hidden="true"></i><span class="visually-hidden">new-history</span> is missing:</p>
        <ol>
          <li>Click on the <i class="fa fa-cog" aria-hidden="true"></i><span class="visually-hidden">galaxy-gear</span> icon (<strong>History options</strong>) on the top of the history panel</li>
          <li>Select the option <strong>Create New</strong> from the menu</li>
        </ol>
      </blockquote>

      <blockquote class="tip">

        <h3 id="tip-tip-renaming-a-history"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Renaming a history</h3>

        <ol>
          <li>Click on <strong>Unnamed history</strong> (or the current name of the history) (<strong>Click to rename history</strong>) at the top of your history panel</li>
          <li>Type the new name</li>
          <li>Press <kbd>Enter</kbd></li>
        </ol>
      </blockquote>
    </li>
    <li>
      <p>Import <code class="highlighter-rouge">GSM461178_untreat_paired_subset_1.fastq</code> from <a href="https://zenodo.org/record/61771">Zenodo</a> or from the data library (ask your instructor)</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/61771/files/GSM461178_untreat_paired_subset_1.fastq
</code></pre></div>      </div>

      <blockquote class="tip">

        <h3 id="tip-tip-importing-data-via-links"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Importing data via links</h3>

        <ul>
          <li>Copy the link location</li>
          <li>
            <p>Open the Galaxy Upload Manager (<i class="fa fa fa-upload" aria-hidden="true"></i><span class="visually-hidden">galaxy-upload</span> on the top-right of the tool panel)</p>
          </li>
          <li>Select <strong>Paste/Fetch Data</strong></li>
          <li>
            <p>Paste the link into the text field</p>
          </li>
          <li>
            <p>Press <strong>Start</strong></p>
          </li>
          <li><strong>Close</strong> the window</li>
        </ul>

        <p>By default, Galaxy uses the URL as the name, so rename the files with a more useful name.</p>
      </blockquote>

      <blockquote class="tip">

        <h3 id="tip-tip-importing-data-from-a-data-library"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Importing data from a data library</h3>

        <p>As an alternative to uploading the data from a URL or your computer, the files may also have been made available from a <em>shared data library</em>:</p>

        <ul>
          <li>
            <p>Go into <strong>Shared data</strong> (top panel) then <strong>Data libraries</strong></p>
          </li>
          <li>
            <p>Find the correct folder (ask your instructor)</p>
          </li>
          <li>Select the desired files</li>
          <li>Click on the <strong>To History</strong> button near the top and select <strong>as Datasets</strong> from the dropdown menu</li>
          <li>In the pop-up window, select the history you want to import the files to (or create a new one)</li>
          <li>Click on <strong>Import</strong></li>
        </ul>
      </blockquote>

      <p>As default, Galaxy takes the link as name, so rename them.</p>
    </li>
    <li>
      <p>Rename the file to <code class="highlighter-rouge">reads_1</code></p>

      <blockquote class="tip">

        <h3 id="tip-tip-renaming-a-dataset"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Renaming a dataset</h3>
        <ul>
          <li>Click on the <i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">galaxy-pencil</span> <strong>pencil icon</strong> for the dataset to edit its attributes</li>
          <li>In the central panel, change the <strong>Name</strong> field</li>
          <li>Click the <strong>Save</strong> button</li>
        </ul>
      </blockquote>
    </li>
  </ol>

</blockquote>

<p>We just imported a file into Galaxy. This file is similar the data we could get directly from a sequencing facility: a <a href="https://en.wikipedia.org/wiki/FASTQ_format">FASTQ file</a>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-inspect-the-fastq-file"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Inspect the FASTQ file</h3>

  <ol>
    <li>Inspect the file by clicking on the <i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">galaxy-eye</span> (eye) icon</li>
  </ol>

</blockquote>

<p>Although it looks complicated (and maybe it is), the FASTQ format is easy to understand with a little decoding.</p>

<p>Each read, representing a fragment of the library, is encoded by 4 lines:</p>

<table>
  <thead>
    <tr>
      <th>Line</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Always begins with <code class="highlighter-rouge">@</code> and then information about the read</td>
    </tr>
    <tr>
      <td>2</td>
      <td>The actual nucleic sequence</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Always begins with a <code class="highlighter-rouge">+</code> and sometimes the same info in line 1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Has a string of characters which represent the quality scores associated with each base of the nucleic sequence; must have the same number of characters as line 2</td>
    </tr>
  </tbody>
</table>

<p>So for example, the first sequence in our file is:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@SRR031716.1 HWI-EAS299_4_30M2BAAXX:3:1:944:1798 length=37
GTGGATATGGATATCCAAATTATATTTGCATAATTTG
+SRR031716.1 HWI-EAS299_4_30M2BAAXX:3:1:944:1798 length=37
IIIIIIIIIIIIIIIIIIIIIIIIIIIII8IIIIIII
</code></pre></div></div>

<p>It means that the fragment named <code class="highlighter-rouge">SRR031716.1</code> corresponds to the DNA sequence <code class="highlighter-rouge">GTGGATATGGATATCCAAATTATATTTGCATAATTTG</code> and this sequence has been sequenced with a quality <code class="highlighter-rouge">IIIIIIIIIIIIIIIIIIIIIIIIIIIII8IIIIIII</code>.</p>

<p>But what does this quality mean?</p>

<p>The quality for each sequence is a string of characters, one for each base of the nucleic sequence, used to characterize the probability of mis-indentification of each base. The score is encoded using the ASCII character table (with <a href="https://en.wikipedia.org/wiki/FASTQ_format#Encoding">some historical differences</a>):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS...............................  Sanger
 ..........................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX  Solexa
 ...............................IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII  Illumina 1.3+
 .................................JJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJ  Illumina 1.5+
 LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL..............................  Illumina 1.8+
 !"#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefgh
 |                         |    |        |                              |
33                        59   64       73                            104
 0........................26...31.......40
                          -5....0........9.............................40
                                0........9.............................40
                                   3.....9.............................40
 0.2......................26...31........41
</code></pre></div></div>

<p>So each nucleotide is assigned an ASCII character, representing its <a href="https://en.wikipedia.org/wiki/Phred_quality_score">Phred quality score</a>, the probability of an incorrect base call:</p>

<table>
  <thead>
    <tr>
      <th>Phred Quality Score</th>
      <th>Probability of incorrect base call</th>
      <th>Base call accuracy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>10</td>
      <td>1 in 10</td>
      <td>90%</td>
    </tr>
    <tr>
      <td>20</td>
      <td>1 in 100</td>
      <td>99%</td>
    </tr>
    <tr>
      <td>30</td>
      <td>1 in 1000</td>
      <td>99.9%</td>
    </tr>
    <tr>
      <td>40</td>
      <td>1 in 10,000</td>
      <td>99.99%</td>
    </tr>
    <tr>
      <td>50</td>
      <td>1 in 100,000</td>
      <td>99.999%</td>
    </tr>
    <tr>
      <td>60</td>
      <td>1 in 1,000,000</td>
      <td>99.9999%</td>
    </tr>
  </tbody>
</table>

<blockquote class="question">
  <h3 id="question-questions"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>Which ASCII character corresponds to the worst Phred score for Illumina 1.8+?</li>
    <li>What is the Phred quality score of the 3rd nucleotide of the 1st sequence?</li>
    <li>What is the accuracy of this 3rd nucleotide?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <ol>
      <li>The worst Phred score is the smallest one, so 0. For Illumina, it corresponds to the <code class="highlighter-rouge">!</code> character.</li>
      <li>The 3rd nucleotide of the 1st sequence has a ASCII character <code class="highlighter-rouge">I</code>, which correspond to a score of 40.</li>
      <li>The corresponding nucleotide <code class="highlighter-rouge">G</code> has an accuracy of 99.99%</li>
    </ol>

  </blockquote>
</blockquote>

<blockquote class="comment">
  <h3 id="comment-comment"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Comment</h3>
  <p>The current lllumina (1.8+) uses Sanger format (Phred+33). If you are working with older datasets you may encounter the older scoring schemes. <strong>FastQC</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>, the tool we will use in the next step, can be used to try to determine what type of quality encoding is used (through assessing the range of Phred values seen in the FASTQ).</p>
</blockquote>

<p>When looking at the file in Galaxy, it looks like most the nucleotides have a high score (<code class="highlighter-rouge">I</code> corresponding to a score 40). Is it true for all sequences? And along the full sequence length?</p>

<h1 id="assess-the-read-quality">Assess the Read Quality</h1>

<p>To estimate sequence quality along all sequences, we now use <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/">FastQC</a>. It is an open-source tool that provides a simple way to quality control raw sequence data. It provides a modular set of analyses which you can use to give a quick impression of whether your data has any problems of which you should be aware before doing any further analysis.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-quality-check"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Quality check</h3>

  <ol>
    <li>Run <strong>FastQC</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><i class="fa fa-files-o" aria-hidden="true"></i><span class="visually-hidden">param-files</span> <em>“Short read data from your current history”</em>: <code class="highlighter-rouge">reads_1</code></li>
      </ul>
    </li>
    <li>Inspect the generated HTML files</li>
  </ol>

</blockquote>

<p>Rather than looking at quality scores for each individual read, FastQC looks at quality collectively across all reads within a sample:</p>

<figure id="figure-1"><img src="../../images/quality-control/per_base_sequence_quality.png" alt="Per base sequence quality" /><figcaption><span class="figcaption-prefix">Figure 1:</span> Per base sequence quality</figcaption></figure>

<p>On the x-axis are the base position in the read, and on the y-axis quality scores. In this example, the sample contains reads that are 37 bp long. For each position, there is a box plotted to illustrate the distribution of values (with the whiskers indicating the 90th and 10th percentile scores). The blue line represents the mean score at the postion. The plot background is color-coded to identify good (green), acceptable (yellow), and bad (red) quality scores.</p>

<blockquote class="question">
  <h3 id="question-questions-1"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>Which Phred encoding is used in the FASTQ file for these sequences?</li>
    <li>How is the mean score changing along the sequence?</li>
    <li>Is this tendency seen in all sequences?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-1"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <ol>
      <li>The Phred scores are encoded using <code class="highlighter-rouge">Sanger / Illumina 1.9</code> (<code class="highlighter-rouge">Encoding</code> in the top table)</li>
      <li>The mean score over the sequence is dropping at the end of the sequences. It is usual: the sequencers are incorporating more errored nucleotides at the end. But the score stays good: over 28.</li>
      <li>The box plots are getting wider at the end of the sequences. It means a lot of sequences have their score dropping at the end of the sequence. At after 31 nucleotides, more than 10% of the sequences have scores below 20.</li>
    </ol>

  </blockquote>
</blockquote>

<p>FastQC produces other diagnostic plots to assess sample quality.</p>

<blockquote class="details">
  <h3 id="details-more-details-about-the-other-fastqc-plots"><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> More details about the other FastQC plots</h3>

  <p>The explanation is adapted from <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help/3%20Analysis%20Modules/">FastQC documentation</a>)</p>

  <ul>
    <li>
      <p><strong>Per sequence quality scores</strong></p>

      <figure id="figure-2"><img src="../../images/quality-control/per_sequence_quality_scores.png" alt="Per sequence quality scores" /><figcaption><span class="figcaption-prefix">Figure 2:</span> Per sequence quality scores</figcaption></figure>

      <p>The per sequence quality score reports if a subset of the sequences have universally low quality values. It is often the case that a subset of sequences will have universally poor quality, often because they are poorly imaged (on the edge of the field of view etc), however these should represent only a small percentage of the total sequences.</p>
    </li>
    <li>
      <p><strong>Per tile sequence quality</strong></p>

      <figure id="figure-3"><img src="../../images/quality-control/per_tile_sequence_quality.png" alt="Per tile sequence quality" /><figcaption><span class="figcaption-prefix">Figure 3:</span> Per tile sequence quality</figcaption></figure>

      <p>This graph will only appear for Illumina library which retains its original sequence identifiers. Encoded in these is the flowcell tile from which each read came. The graph enables you to look at the quality scores from each tile across all of your bases to see if there was a loss in quality associated with only one part of the flowcell.</p>

      <p>The plot shows the deviation from the average quality for each tile. The colours are on a cold to hot scale, with cold colours being positions where the quality was at, or above, the average for that base in the run, and hotter colours indicate that a tile had worse qualities than other tiles for that base. In the example above you can see that certain tiles show consistently poor quality. A good plot should be blue all over.</p>
    </li>
    <li>
      <p><strong>Per base sequence content</strong></p>

      <figure id="figure-4"><img src="../../images/quality-control/per_base_sequence_content.png" alt="Per base sequence content" /><figcaption><span class="figcaption-prefix">Figure 4:</span> Per base sequence content</figcaption></figure>

      <p>Per Base Sequence Content plots out the proportion of each of the four DNA bases (T, C, A, G) at each position along the reads.</p>

      <p>In a random library we would expect that there would be little to no difference between the four bases, so the lines in this plot should run parallel with each other. The relative amount of each base should reflect the overall amount of these bases in the genome, but in any case they should not be hugely imbalanced from each other.</p>

      <p>It’s worth noting that some types of library will always produce biased sequence composition, normally at the start of the read. Libraries produced by priming using random hexamers (including nearly all RNA-Seq libraries), and those which were fragmented using transposases, will contain an intrinsic bias in the positions at which reads start. This bias does not involve a specific sequence, but instead provides enrichment of a number of different K-mers at the 5’ end of the reads. Whilst this is a true technical bias, it isn’t something which can be corrected by trimming and in most cases doesn’t seem to adversely affect the downstream analysis. It will, however, produce a warning or error in this module.</p>
    </li>
    <li>
      <p><strong>Per sequence GC content</strong></p>

      <figure id="figure-5"><img src="../../images/quality-control/per_sequence_gc_content.png" alt="Per sequence GC content" /><figcaption><span class="figcaption-prefix">Figure 5:</span> Per sequence GC content</figcaption></figure>

      <p>This plot displays the GC content across the whole length of each sequence in a file and compares it to a modelled normal distribution of GC content.</p>

      <p>In a normal random library we would expect to see a roughly normal distribution of GC content, where the central peak corresponds to the overall GC content of the underlying genome. Since we don’t know the GC content of the genome the modal GC content is calculated from the observed data and used to build a reference distribution.</p>

      <p>An unusually-shaped distribution could indicate a contaminated library or some other kind of biased subset. A normal distribution which is shifted indicates some systematic bias, which is independent of base position. If there is a systematic bias which creates a shifted normal distribution then this won’t be flagged as an error by the module since it doesn’t know what your genome’s GC content should be.</p>
    </li>
    <li>
      <p><strong>Per base N content</strong></p>

      <figure id="figure-6"><img src="../../images/quality-control/per_base_n_content.png" alt="Per base N content" /><figcaption><span class="figcaption-prefix">Figure 6:</span> Per base N content</figcaption></figure>

      <p>If a sequencer is unable to make a base call with sufficient confidence then it will normally substitute an N rather than a conventional base call.</p>

      <p>It plots out the percentage of base calls at each position for which an N was called.</p>

      <p>It’s not unusual to see a very low proportion of Ns appearing in a sequence, especially near the end of a sequence. However, if this proportion rises above a few percent it suggests that the analysis pipeline was unable to interpret the data well enough to make valid base calls.</p>
    </li>
    <li>
      <p><strong>Sequence length distribution</strong></p>

      <figure id="figure-7"><img src="../../images/quality-control/sequence_length_distribution.png" alt="Sequence length distribution" /><figcaption><span class="figcaption-prefix">Figure 7:</span> Sequence &gt; length distribution</figcaption></figure>

      <p>Some high throughput sequencers generate sequence fragments of uniform length, but others can contain reads of wildly varying lengths. Even within uniform length libraries some pipelines will trim sequences to remove poor quality base calls from the end.</p>

      <p>This graph shows the distribution of fragment sizes in the file which was analysed. In many cases this will produce a simple graph showing a peak only at one size, but for variable length FASTQ files this will show the relative amounts of each different size of sequence fragment.</p>
    </li>
    <li>
      <p><strong>Sequence Duplication Levels</strong></p>

      <figure id="figure-8"><img src="../../images/quality-control/sequence_duplication_levels.png" alt="Sequence Duplication Levels" /><figcaption><span class="figcaption-prefix">Figure 8:</span> Sequence Duplication Levels</figcaption></figure>

      <p>In a diverse library most sequences will occur only once in the final set. A low level of duplication may indicate a very high level of coverage of the target sequence, but a high level of duplication is more likely to indicate some kind of enrichment bias (eg PCR over amplification).</p>

      <p>FastQC counts the degree of duplication for every sequence in a library and creates a plot showing the relative number of sequences with different degrees of duplication.</p>

      <p>There are two lines on the plot. The blue line takes the full sequence set and shows how its duplication levels are distributed. In the red plot the sequences are de-duplicated and the proportions shown are the proportions of the deduplicated set which come from different duplication levels in the original data.</p>

      <p>In a properly diverse library most sequences should fall into the far left of the plot in both the red and blue lines. A general level of enrichment, indicating broad oversequencing in the library will tend to flatten the lines, lowering the low end and generally raising other categories. More specific enrichments of subsets, or the presence of low complexity contaminants will tend to produce spikes towards the right of the plot. These high duplication peaks will most often appear in the blue trace as they make up a high proportion of the original library, but usually disappear in the red trace as they make up an insignificant proportion of the deduplicated set. If peaks persist in the blue trace then this suggests that there are a large number of different highly duplicated sequences which might indicate either a contaminant set or a very severe technical duplication.</p>
    </li>
    <li>
      <p><strong>Overrepresented sequences</strong></p>

      <p>A normal high-throughput library will contain a diverse set of sequences, with no individual sequence making up a tiny fraction of the whole. Finding that a single sequence is very overrepresented in the set either means that it is highly biologically significant, or indicates that the library is contaminated, or not as diverse as you expected.</p>

      <p>FastQC lists all of the sequence which make up more than 0.1% of the total. For each overrepresented sequence FastQC will look for matches in a database of common contaminants and will report the best hit it finds. Hits must be at least 20bp in length and have no more than 1 mismatch. Finding a hit doesn’t necessarily mean that this is the source of the contamination, but may point you in the right direction. It’s also worth pointing out that many adapter sequences are very similar to each other so you may get a hit reported which isn’t technically correct, but which has very similar sequence to the actual match.</p>
    </li>
    <li>
      <p><strong>Adapter Content</strong></p>

      <figure id="figure-9"><img src="../../images/quality-control/adapter_content.png" alt="Adapter Content" /><figcaption><span class="figcaption-prefix">Figure 9:</span> Adapter Content</figcaption></figure>

      <p>FastQC does a generic analysis of all of the Kmers in the library to find those which do not have even coverage through the length of your reads. This can find a number of different sources of bias in the library which can include the presence of read-through adapter sequences building up on the end of your sequences.</p>

      <p>The presence of any overrepresented sequences in your library (such as adapter dimers) causes the Kmer plot to be dominated by the Kmers these sequences contain, and then it’s not always easy to see if there are other biases present in which you might be interested.</p>

      <p>The plot shows a cumulative percentage count of the proportion of your library which has seen each of the adapter sequences at each position. Once a sequence has been seen in a read it is counted as being present right through to the end of the read so the percentages you see will only increase as the read length goes on.</p>
    </li>
  </ul>

</blockquote>

<blockquote class="question">
  <h3 id="question-questions-2"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <p>Why is there a warning for the per-base sequence content and the per-sequence GC content graphs?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-2"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <p>In the beginning of sequences, the sequence content per base is not really good and the percentages are not equal. For the GC content, the distribution is slightly shifted on the left, and too high.</p>
  </blockquote>
</blockquote>

<h1 id="filter-and-trim">Filter and Trim</h1>

<p>We will filter and trim the sequences based on the information provided by the quality graphs, the quality of the sequences drops at the end of the sequences. This could cause bias in downstream analyses with these potentially incorrectly called nucleotides.</p>

<p>Sequences must be treated to reduce bias in downstream analyis. In general, quality treatments include:</p>

<ul>
  <li>Filtering of sequences
    <ul>
      <li>with low mean quality score</li>
      <li>too short</li>
      <li>with too many ambiguous (N) bases</li>
      <li>based on their GC content</li>
    </ul>
  </li>
  <li>Cutting/Trimming/masking sequences
    <ul>
      <li>from low quality score regions</li>
      <li>beginning/end of sequence</li>
      <li>removing adapters</li>
    </ul>
  </li>
</ul>

<p>To accomplish this task we will use <a href="https://cutadapt.readthedocs.io/en/stable/guide.html">Cutadapt</a>, a tool that enhances sequence quality by automating adapter trimming as well as quality control.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-improvement-of-sequence-quality"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Improvement of sequence quality</h3>

  <ol>
    <li>Run <strong>Cutadapt</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><em>“Single-end or Paired-end reads?”</em>: <code class="highlighter-rouge">Single-end</code>
          <ul>
            <li>
              <p><i class="fa fa-file-o" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“Reads in FASTQ format”</em>: <code class="highlighter-rouge">reads_1</code> (Input dataset)</p>

              <blockquote class="tip">
                <h3 id="tip-tip-files-not-selectable"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Files not selectable?</h3>
                <p>If your FASTQ files cannot be selected, you might check whether their format is FASTQ with Sanger-scaled quality values (<code class="highlighter-rouge">fastqsanger</code>). You can edit the data type by clicking on the pencil symbol.</p>
              </blockquote>
            </li>
            <li>
              <p>In <em>Read 1 Options</em></p>

              <p>In this training, no adapters were already removed. If you know which adapter sequences were used during library preparation, provide their sequences there.</p>
            </li>
          </ul>
        </li>
        <li>In <em>“Adapter Options”</em>
          <ul>
            <li><em>“Minimum overlap length”</em>: <code class="highlighter-rouge">3</code></li>
          </ul>
        </li>
        <li>In <em>“Filter Options”</em>
          <ul>
            <li>
              <p><em>“Minimum length”</em>: <code class="highlighter-rouge">20</code></p>

              <p>To remove reads shorter than 20 bp</p>
            </li>
          </ul>
        </li>
        <li>In <em>“Read Modification Options”</em>
          <ul>
            <li>
              <p><em>“Quality cutoff”</em>: <code class="highlighter-rouge">20</code></p>

              <p>To trim low-quality 3’ ends (below 20) from reads in addition to adapter removal</p>
            </li>
          </ul>
        </li>
        <li>In <em>“Output Options”</em>
          <ul>
            <li><em>“Report”</em>: <code class="highlighter-rouge">Yes</code></li>
          </ul>
        </li>
      </ul>
    </li>
    <li>
      <p>Inspect the generated txt file (<code class="highlighter-rouge">Report</code>)</p>

      <blockquote class="question">
        <h3 id="question-questions-3"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

        <ol>
          <li>How many reads have been found with adapters?</li>
          <li>How many basepairs have been removed from the reads because of bad quality?</li>
          <li>How many sequence pairs have been removed because they were too short?</li>
        </ol>

        <blockquote class="solution">
          <h3 id="solution-solution-3"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <ol>
            <li>0 reads with adapters</li>
            <li>44,164 bp (1.2%) (<code class="highlighter-rouge">Quality-trimmed:</code>)</li>
            <li>322 sequences</li>
          </ol>
        </blockquote>
      </blockquote>
    </li>
    <li>
      <p>(Optional) <strong>FastQC</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>: Re-run <strong>FastQC</strong> on the quality-controlled data, and inspect the new FastQC report</p>

      <blockquote class="question">
        <h3 id="question-questions-4"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

        <ol>
          <li>How many sequences have been removed?</li>
          <li>Has sequence quality been improved?</li>
        </ol>

        <blockquote class="solution">
          <h3 id="solution-solution-4"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <ol>
            <li>Before Cutadapt, the dataset comprised 100,000 sequences. After Cutadapt, there are 99,678 sequences</li>
            <li>The per-base quality score looks better, but other indicators show bad values now. The sequence length distribution is not clear anymore because sequences have different size after the trimming operation</li>
          </ol>
        </blockquote>
      </blockquote>
    </li>
  </ol>
</blockquote>

<p>The quality of the previous dataset was pretty good from the beginning and we improved it with with trimming and filtering step (in a reasonable way to not lose too much information)</p>

<blockquote class="comment">
  <h3 id="comment-bad-quality-sequences"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Bad quality sequences</h3>
  <p>If the quality of the reads is not good, we should always first check what is wrong and think about it: it may come from the type of sequencing or what we sequenced (high quantity of overrepresented sequences in transcriptomics data, biaised percentage of bases in HiC data).</p>

  <p>You can also ask the sequencing facility about it, especially if the quality is really bad: the quality treatments can not solve everything and you may lose too much information.</p>
</blockquote>

<h1 id="process-paired-end-data">Process paired-end data</h1>

<p>With paired-end sequencing, the fragments are sequenced from both sides. This approach results in two reads per fragment, with the first read in forward orientation and the second read in reverse-complement orientation. The distance between both reads is known and therefore is additional information that can improve read mapping.</p>

<p>With paired-end sequencing, more of each DNA fragment can be covered than with single-end sequencing (only forward orientation sequenced):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ------&gt;
      ------&gt;
        ------&gt;
          ------&gt;

    ----------------------------- [fragment]

    ------&gt;         &lt;------
      ------&gt;         &lt;------
        ------&gt;         &lt;------
          ------&gt;         &lt;------
</code></pre></div></div>

<p>Paired-end sequencing generates 2 FASTQ files:</p>
<ul>
  <li>One file with the sequences corresponding to foward orientation of all the fragments</li>
  <li>One file with the sequences corresponding to reverse orientation of all the fragments</li>
</ul>

<p>The data we analyzed in the previous step was not single-end data but the forward reads of paired-end data. We will now do the quality control on both forward and reverse reads together.</p>

<blockquote class="question">
  <h3 id="question-questions-5"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <p>Why is performing quality control on both forward and reverse reads together important?</p>

  <blockquote class="solution">
    <h3 id="solution-solution-5"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
    <p>During the filtering, some reads are eliminated because of their length. If one of the reverse reads is removed, its corresponding forward read should be removed too. So the forward and reverse reads should be processed together.</p>
  </blockquote>
</blockquote>

<p>Let’s first have a look at the quality of our reads!</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-assessing-the-quality-of-paired-end-data"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Assessing the quality of paired-end data</h3>

  <ol>
    <li>
      <p>Import the reverse read <code class="highlighter-rouge">GSM461178_untreat_paired_subset_2.fastq</code> from <a href="https://zenodo.org/record/61771">Zenodo</a> or from the data library (ask your instructor)</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://zenodo.org/record/61771/files/GSM461178_untreat_paired_subset_2.fastq
</code></pre></div>      </div>
    </li>
    <li>Rename the file to <code class="highlighter-rouge">reads_2</code></li>
    <li>
      <p><strong>FastQC</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the reverse reads</p>

      <p>FastQC has already been run on the forward reads</p>
    </li>
    <li><strong>MultiQC</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters to aggregate the FastQC reports
      <ul>
        <li>In <em>“Results”</em>
          <ul>
            <li><em>“Which tool was used generate logs?”</em>: <code class="highlighter-rouge">FastQC</code></li>
            <li>In <em>“FastQC output”</em>
              <ul>
                <li><em>“Type of FastQC output?”</em>: <code class="highlighter-rouge">Raw data</code></li>
                <li><i class="fa fa-files-o" aria-hidden="true"></i><span class="visually-hidden">param-files</span> <em>“FastQC output”</em>: <code class="highlighter-rouge">Raw data</code> files (output of both <strong>FastQC</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span>)</li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>

      <blockquote class="tip">

        <h3 id="tip-tip-select-multiple-datasets"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Select multiple datasets</h3>

        <ol>
          <li>Click on <i class="fa fa-files-o" aria-hidden="true"></i><span class="visually-hidden">param-files</span> <strong>Multiple datasets</strong></li>
          <li>Select several files by keeping the <kbd>Ctrl</kbd> (or
<kbd>COMMAND</kbd>) key pressed and clicking on the files of interest</li>
        </ol>
      </blockquote>
    </li>
    <li>
      <p>Inspect the webpage output from MultiQC</p>

      <blockquote class="question">
        <h3 id="question-questions-6"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

        <ol>
          <li>What do you think of the quality of the sequences?</li>
          <li>What should we do?</li>
        </ol>

        <blockquote class="solution">
          <h3 id="solution-solution-6"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

          <ol>
            <li>The quality of the sequences seems worse for the reverse reads than for the forward reads: lower mean quality of the sequences and stronger decrease at the end (mean value below 28). Lower-quality reverse reads .</li>
            <li>We should trim the end of the sequences and filter them with <strong>Cutadapt</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
          </ol>

        </blockquote>
      </blockquote>
    </li>
  </ol>

</blockquote>

<p>It is usual that the quality of the sequences is worse for the reverse than for the forward reads. Therefore it is important to treat the forward and reverse reads together.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-assessing-the-quality-of-paired-end-data-1"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Assessing the quality of paired-end data</h3>
  <ol>
    <li><strong>Cutadapt</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters
      <ul>
        <li><em>“Single-end or Paired-end reads?”</em>: <code class="highlighter-rouge">Paired-end</code>
          <ul>
            <li><i class="fa fa-file-o" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“FASTQ/A file #1”</em>: <code class="highlighter-rouge">reads_1</code> (Input dataset)</li>
            <li>
              <p><i class="fa fa-file-o" aria-hidden="true"></i><span class="visually-hidden">param-file</span> <em>“FASTQ/A file #2”</em>: <code class="highlighter-rouge">reads_2</code> (Input dataset)</p>

              <p>The order is important here!</p>
            </li>
            <li>
              <p>In <em>Read 1 Options</em> or <em>Read 2 Options</em></p>

              <p>In this training, no adapters were already removed. When you process your own data, if you know which adapter sequences were used during library preparation, you should provide their sequences here.</p>
            </li>
          </ul>
        </li>
        <li>In <em>“Adapter Options”</em>
          <ul>
            <li><em>“Minimum overlap length”</em>: <code class="highlighter-rouge">3</code></li>
          </ul>
        </li>
        <li>In <em>“Filter Options”</em>
          <ul>
            <li><em>“Minimum length”</em>: <code class="highlighter-rouge">20</code></li>
          </ul>
        </li>
        <li>In <em>“Read Modification Options”</em>
          <ul>
            <li><em>“Quality cutoff”</em>: <code class="highlighter-rouge">20</code></li>
          </ul>
        </li>
        <li>In <em>“Output Options”</em>
          <ul>
            <li><em>“Report”</em>: <code class="highlighter-rouge">Yes</code></li>
          </ul>
        </li>
      </ul>
    </li>
    <li>
      <p>Inspect the generated txt file (<code class="highlighter-rouge">Report</code>)</p>

      <blockquote class="question">
        <h3 id="question-questions-7"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

        <ol>
          <li>How many basepairs has been removed from the reads because of bad quality?</li>
          <li>How many sequence pairs have been removed because they were too short?</li>
        </ol>

        <blockquote class="solution">
          <h3 id="solution-solution-7"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <ol>
            <li>44,164 bp (<code class="highlighter-rouge">Quality-trimmed:</code>) for the forward reads and 138,638 bp for the reverse reads.</li>
            <li>1,376 sequences have been removed because at least one read was shorter than the length cutoff (334 when only the forward reads were analyzed).</li>
          </ol>
        </blockquote>
      </blockquote>
    </li>
  </ol>
</blockquote>

<blockquote class="details">
  <h3 id="details-algorithmic-details"><i class="fa fa-info-circle" aria-hidden="true"></i><span class="visually-hidden">details</span> Algorithmic details</h3>

  <p>One of the biggest advantage of cutadapt over other trimming tools is that it has nice <a href="https://cutadapt.readthedocs.io">documentation</a> explaining how the tool works in detail.</p>

  <p>Cutadapt quality trimming algorithm consists of three simple steps:</p>

  <ol>
    <li>substract the chosen threshold value from the quality value of each position</li>
    <li>compute a partial sum of these differences from the end of the sequence to each position
(as long as the partial sum is negative)</li>
    <li>cut at the minimum value of the partial sum</li>
  </ol>

  <p>In the following example, we assume that the 3’ end is to be quality-trimmed with a threshold of 10 and we have the following quality values</p>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>42 40 26 27 8 7 11 4 2 3
</code></pre></div>  </div>

  <ol>
    <li>
      <p>Subtract the threshold</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 32 30 16 17 -2 -3 1 -6 -8 -7
</code></pre></div>      </div>
    </li>
    <li>
      <p>Add up the numbers, starting from the 3’ end (partial sums) and stop early if the sum is greater than zero</p>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> (70) (38) 8 -8 -25 -23 -20, -21 -15 -7
</code></pre></div>      </div>

      <p>The numbers in parentheses are not computed (because 8 is greater than zero), but shown here for completeness.</p>
    </li>
    <li>
      <p>Choose the position of the minimum (<code class="highlighter-rouge">-25</code>) as the trimming position</p>
    </li>
  </ol>

  <p>Therefore, the read is trimmed to the first four bases, which have quality values</p>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>42 40 26 27
</code></pre></div>  </div>

  <p>Note that thereby also positions with a quality value larger than the chosen threshold are removed if they are embedded in regions with lower quality (note that the partial sum is decreasing if the quality values are smaller than the threshold). The advantage of this procedure is that it is robust against a small number of positions with a quality higher than the threshold.</p>

  <p>Alternatives to this procedure would be</p>

  <ul>
    <li>to cut all positions with a quality smaller than the threshold</li>
    <li>a sliding window approach</li>
  </ul>

  <p>The sliding window approach checks that the average quality of each sequence window of specified length is larger than the threshold. Note that in contrast to cutadapt’s approach, this approach has one more parameter and the robustness depends of the length of the windows (in combination with the quality threshold). Both approaches are implemented in Trimmomatic.</p>
</blockquote>

<blockquote class="question">
  <h3 id="question-questions-8"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</h3>

  <ol>
    <li>What kind of alignment is used for finding adapters in reads?</li>
    <li>What is the criterion to choose the best adapter alignment?</li>
  </ol>

  <blockquote class="solution">
    <h3 id="solution-solution-8"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>

    <ol>
      <li>Semi global alignment, i.e., only the overlapping part of the read and the adapter sequence is used for scoring.</li>
      <li>An alignment with maximum overlap is computed that has a smallest number of mismatches and indels.</li>
    </ol>

  </blockquote>
</blockquote>

<h1 class="no_toc" id="conclusion">Conclusion</h1>

<p>In this tutorial we checked the quality of two FASTQ files to ensure that their data looks good before inferring any further information. This step is the usual first step for analyses such as RNA-Seq, ChIP-Seq, or any other OMIC analysis relying on NGS data. Quality control steps are similar for any type of sequencing data:</p>

<ul>
  <li>Quality assessment with a tool like <strong>FastQC</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
  <li>Trimming and filtering with a tool like <strong>Cutadapt</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span></li>
</ul>



                    
                    <blockquote class="key_points">
                        <h3><i class="fa fa-key" aria-hidden="true"></i><span class="visually-hidden">keypoints</span> Key points</h3>

                        <ul>
                            
                            <li>Run quality control on every dataset before running any other bioinformatics analysis</li>
                            
                            <li>Take care of the parameters used to improve the sequence quality</li>
                            
                            <li>Re-run FastQC to check the impact of the quality control</li>
                            
                            <li>For paired-end reads analyze the forward and reverse reads together</li>
                            
                        </ul>
                    </blockquote>
                    

                    
                    <h1 data-toc-skip>Useful literature</h1>
                    <p>Further information, including links to documentation and original publications, regarding the tools, analysis techniques and the interpretation of results described in this tutorial can be found <a href="/training-material/topics/sequence-analysis#references">here</a>.</p>
                    

                    

                </div>
            </div>
        </div>

        <h3><i class="fa fa-thumbs-up" aria-hidden="true"></i><span class="visually-hidden">congratulations</span> Congratulations on successfully completing this tutorial!</h3>

        

        
        <blockquote class="agenda follow-up">
            <strong class="follow-up"><i class="fa fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">curriculum</span> Do you want to extend your knowledge? Follow one of our recommended follow-up trainings:</strong>
            <ul>
                
    <li>
    
        
        
        <a href="/training-material/topics/sequence-analysis">Sequence analysis</a>
        
            <ul>
                
                    
                        
                            
                            <li> Mapping:
                            
                                <a href="/training-material/topics/sequence-analysis/tutorials/mapping/slides.html"><i class="fa fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> slides</a>
                                
                            
                            
                                
                                    - <a href="/training-material/topics/sequence-analysis/tutorials/mapping/tutorial.html"><i class="fa fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

            </ul>
        </blockquote>
        

        <hr>
        <br>

        <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Quality Control (Sequence analysis)">Loading...
        </iframe>

        <blockquote class="feedback">
            <h3><i class="fa fa-comments-o" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Give us even more feedback on this content!</h3>
            <p>To give us more detailed feedback about these materials, please take a moment to fill in the extended <a href="https://docs.google.com/forms/d/e/1FAIpQLSc_GLZRpxZGAL9tN6DA1bE6WkNhmQdXT7B16TpOb-X4YwKUsQ/viewform?entry.1548889262=Quality Control (Sequence analysis)">Feedback Form</a>.</p>
        </blockquote>
    </section>
</div>


<footer>
    <div class="container">
        <p>
            This material is the result of a collaborative work. Thanks to the
            <a href="https://wiki.galaxyproject.org/Teach/GTN">Galaxy Training Network</a>
            and all the <a href="/training-material/hall-of-fame">contributors</a> (Bérénice Batut)!
        </p>
        <p>
            Found a typo? Something is wrong in this tutorial? Edit it on
            <a href="https://github.com/galaxyproject/training-material/tree/master/topics/sequence-analysis/tutorials/quality-control/tutorial.md">GitHub</a>.
        </p>
    </div>
</footer>

    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
</html>

<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Collections: Rule Based Uploader</title>
        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-45719423-18' , 'auto');
            ga('send', 'pageview');
        </script>
        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <link rel="stylesheet" href="/training-material/assets/css/font-awesome.css">
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

        
        
        
        
        
        <meta name="description" content="A collection of microtutorials explaining data manipulati..." />
        <meta property="og:title" content="Galaxy Training: Collections: Rule Based Uploader" />
        <meta property="og:description" content="A collection of microtutorials explaining data manipulati..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        











<header>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/galaxy-data-manipulation" title="Go back to list of tutorials">
                            <i class="fa fa-folder-o" aria-hidden="true"></i><span class="visually-hidden">topic</span> Data Manipulation
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="EN">
                            EN
                        </a>
                        <div class="dropdown-menu">
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fgalaxy-data-manipulation%2Ftutorials%2Fupload-rules%2Ftutorial.html&edit-text=&act=url" title="">
                                FR
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fgalaxy-data-manipulation%2Ftutorials%2Fupload-rules%2Ftutorial.html&edit-text=&act=url" title="">
                                JA
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fgalaxy-data-manipulation%2Ftutorials%2Fupload-rules%2Ftutorial.html&edit-text=&act=url" title="">
                                ES
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fgalaxy-data-manipulation%2Ftutorials%2Fupload-rules%2Ftutorial.html&edit-text=&act=url" title="">
                                PT
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fgalaxy-data-manipulation%2Ftutorials%2Fupload-rules%2Ftutorial.html&edit-text=&act=url" title="">
                                AR
                            </a>
                            
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="fa fa-life-ring" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>

        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQ">
            FAQ
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Chat on Gitter">
            Chat on Gitter
        </a>
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            Discuss on Galaxy Help
        </a>
    </div>
</li>


                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/galaxy-data-manipulation/tutorials/upload-rules/tutorial.md">
                            <i class="fa fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="container main-content">
    <script type="application/ld+json">
        


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Collections: Rule Based Uploader",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "/blob//LICENSE.md",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "courseCode": "galaxy-data-manipulation / upload-rules / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Collections: Rule Based Uploader' tutorial",
  "isPartOf": {
    "@type": "Course",
    "name": "Collections: Rule Based Uploader",
    "description": "Collections: Rule Based Uploader",
    "learningResourceType": "tutorial",
    "interactivityType": "expositive",
    "provider": {
      "@type": "Organization",
      "email": "galaxytrainingnetwork@gmail.com",
      "name": "Galaxy Training Network",
      "url": "https://galaxyproject.org/teach/gtn/"
    }
  },
  "url": "https://galaxyproject.github.io//training-material/topics/galaxy-data-manipulation/tutorials/upload-rules/tutorial.html",
  "timeRequired": "PT30M",
  "description": "Collections: Rule Based Uploader\\nThe questions this  addresses are:\n - How to use the rule based uploader to create complex collections\n\n\\nThe objectives are:\n - Learn about the Rule Based Uploader\n\n",
  "coursePrerequisites": [
    {
      "@type": "Course",
      "url": "https://galaxyproject.github.io//training-material/topics/galaxy-data-manipulation/tutorials/collections/tutorial.html",
      "name": "Collections: Using dataset collection",
      "description": "Hands-on for 'Collections: Using dataset collection' tutorial",
      "learningResourceType": "hands-on tutorial",
      "interactivityType": "expositive",
      "provider": {
        "@type": "Organization",
        "email": "galaxytrainingnetwork@gmail.com",
        "name": "Galaxy Training Network",
        "url": "https://galaxyproject.org/teach/gtn/"
      }
    }
  ],
  "hasPart": [

  ],
  "mentions": [
    {
      "@type": "Thing",
      "url": "",
      "name": "Training data for Collections: Rule Based Uploader tutorial"
    }
  ],
  "author": [
    {
      "@type": "Person",
      "name": "John Chilton"
    },
    {
      "@type": "Person",
      "name": "Helena Rasche"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "John Chilton"
    },
    {
      "@type": "Person",
      "name": "Helena Rasche"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Data Manipulation",
      "description": "A collection of microtutorials explaining data manipulation within Galaxy",
      "url": "https://galaxyproject.github.io//training-material/topics/galaxy-data-manipulation/"
    },
    {
      "@type": "DefinedTerm",
      "@id": "http://edamontology.org/",
      "inDefinedTermSet": "http://edamontology.org",
      "termCode": "",
      "url": "https://bioportal.bioontology.org/ontologies/EDAM/?p=classes&conceptid=http%3A%2F%2Fedamontology.org%2F"
    }
  ],
  "skillLevel": "Advanced"
}
    </script>

    <section class="tutorial">
        <h1 data-toc-skip>Collections: Rule Based Uploader</h1>
        <div class="contributors-line">By: 

<a href="/training-material/hall-of-fame#jmchilton" class="contributor-badge"><img src="https://avatars.githubusercontent.com/jmchilton" alt="John Chilton">John Chilton</a>, <a href="/training-material/hall-of-fame#erasche" class="contributor-badge"><img src="https://avatars.githubusercontent.com/erasche" alt="Helena Rasche">Helena Rasche</a>

</div>
        <blockquote class="overview">
            <h3>Overview</h3>
            <strong><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</strong>
            <ul>
            
            <li>How to use the rule based uploader to create complex collections</li>
            
            </ul>

            <strong><i class="fa fa-bullseye" aria-hidden="true"></i><span class="visually-hidden">objectives</span> Objectives</strong>
            <ul>
            
            <li>Learn about the Rule Based Uploader</li>
            
            </ul>

            
            <strong><i class="fa fa-check-circle" aria-hidden="true"></i><span class="visually-hidden">requirements</span> Requirements</strong>
            <ul>
            
            
    <li>
    
        
        
        <a href="/training-material/topics/galaxy-data-manipulation">Data Manipulation</a>
        
            <ul>
                
                    
                        
                    
                        
                    
                        
                            
                            <li> Collections: Using dataset collection:
                            
                            
                                
                                     <a href="/training-material/topics/galaxy-data-manipulation/tutorials/collections/tutorial.html"><i class="fa fa-laptop" aria-hidden="true"></i><span class="visually-hidden">tutorial</span> hands-on</a>
                                
                            
                            </li>
                        
                    
                        
                    
                        
                    
                        
                    
                
            </ul>
        
    
    </li>

            </ul>
            

            
            <p><strong><i class="fa fa-hourglass-end" aria-hidden="true"></i><span class="visually-hidden">time</span> Time estimation:</strong> 30 minutes</p>
            

            
            <p><strong><i class="fa fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">level</span> Level: </strong>
             Advanced 
<span class="level advanced" title="Advanced Tutorial">
  <i class="fa fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">level</span> <i class="fa fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">level</span> <i class="fa fa-graduation-cap" aria-hidden="true"></i><span class="visually-hidden">level</span>
</span>

</p>
            



            <div>
                <div><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials</strong></div>
                <div id="supporting_materials">
                    <ul>
                        <li>
                            <div>
                    

                    

                    
                    


                    
                            </div>
                        </li>
                    </ul>
                </div>

            </div>

        </blockquote>

        <div class="container">
            <div class="row">
                <!-- sidebar, which will move to the top on a small screen -->
                <div class="col-sm-2">
                    <nav id="toc" data-toggle="toc" class="sticky-top"></nav>
                </div>
                <div class="col-sm-10">
                    <h1 class="no_toc" id="introduction">Introduction</h1>

<p>Through a series of examples, this tutorial aims to familiarize the reader with building Galaxy collections from tabular data containing URLs, sample sheets, list of accessions or identifiers, etc..</p>

<blockquote class="comment">
  <h3 id="comment-audience"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Audience</h3>
  <p>This tutorial assumes a basic knowledge of using dataset collections in Galaxy but doesn’t assume any particular knowledge of biology or bioinformatics. If you have not used collections with Galaxy previously, please check out the <a href="/training-material/topics/galaxy-data-manipulation/tutorials/collections/tutorial.html">using dataset collections</a> tutorial.</p>
</blockquote>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

  <p>In this tutorial, we will:</p>

<ol id="markdown-toc">
  <li><a href="#uploading-datasets-with-rules" id="markdown-toc-uploading-datasets-with-rules">Uploading Datasets with Rules</a></li>
  <li><a href="#creating-a-simple-dataset-list" id="markdown-toc-creating-a-simple-dataset-list">Creating a Simple Dataset List</a></li>
  <li><a href="#creating-a-list-of-dataset-pairs" id="markdown-toc-creating-a-list-of-dataset-pairs">Creating a List of Dataset Pairs</a></li>
  <li><a href="#building-urls-from-accession-information" id="markdown-toc-building-urls-from-accession-information">Building URLs from Accession Information</a></li>
  <li><a href="#building-matched-collections" id="markdown-toc-building-matched-collections">Building Matched Collections</a></li>
  <li><a href="#building-nested-lists" id="markdown-toc-building-nested-lists">Building Nested Lists</a></li>
  <li><a href="#apply-rules-to-existing-collections" id="markdown-toc-apply-rules-to-existing-collections">Apply Rules to Existing Collections</a></li>
</ol>

</blockquote>

<h1 id="uploading-datasets-with-rules">Uploading Datasets with Rules</h1>

<p>This approach could be used to manipulate lists of uploads coming from many different formats, but we will start with a tabular description of files for a study from the <a href="https://www.ebi.ac.uk/ena">European Nucleotide Archive</a>. We will be using the data from a study of <a href="https://www.ebi.ac.uk/ena/data/view/PRJDA60709">16s ribosomal RNA</a>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-downloading-data-from-ena"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Downloading Data from ENA</h3>
  <p>To start, navigate to the above study and click the option to “Select columns”. Here we will narrow the set of columns we consider to just a few relevant to uploading these files to Galaxy.</p>

  <p>Select only:</p>

  <ul>
    <li>Study accession</li>
    <li>Experiment accession</li>
    <li>FASTQ files (FTP)</li>
    <li>Sample accession</li>
  </ul>

  <p>The table should look like:</p>

  <table>
    <thead>
      <tr>
        <th>Study accession</th>
        <th>Sample accession</th>
        <th>Experiment accession</th>
        <th>FASTQ files (FTP)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>PRJDA60709</td>
        <td>SAMD00016379</td>
        <td>DRX000475</td>
        <td>File 1</td>
      </tr>
      <tr>
        <td>PRJDA60709</td>
        <td>SAMD00016383</td>
        <td>DRX000476</td>
        <td>File 1</td>
      </tr>
      <tr>
        <td>PRJDA60709</td>
        <td>SAMD00016380</td>
        <td>DRX000477</td>
        <td>File 1</td>
      </tr>
      <tr>
        <td>PRJDA60709</td>
        <td>SAMD00016378</td>
        <td>DRX000478</td>
        <td>File 1</td>
      </tr>
      <tr>
        <td>PRJDA60709</td>
        <td>SAMD00016381</td>
        <td>DRX000479</td>
        <td>File 1</td>
      </tr>
      <tr>
        <td>PRJDA60709</td>
        <td>SAMD00016382</td>
        <td>DRX000480</td>
        <td>File 1</td>
      </tr>
    </tbody>
  </table>

  <p>Download the resulting tabular data describing the files by clicking the “TEXT” link at the top of the page. Alternatively, the resulting sample sheet can be downloaded directly <a href="https://www.ebi.ac.uk/ena/data/warehouse/filereport?accession=PRJDA60709&amp;result=read_run&amp;fields=study_accession,sample_accession,experiment_accession,fastq_ftp&amp;download=txt">here</a>. The number and size of the files for this example are relatively small for sequencing data but larger files and larger numbers of files should work as well - Galaxy will just need more time to download and process the files.</p>
</blockquote>

<p>You can now open the resulting spreadsheet in your local spreadsheet program, a text editor, or in your web browser and select all the data and copy to your clipboard.</p>

<div id="example-1-metadata" class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>study_accession	sample_accession	experiment_accession	fastq_ftp
PRJDA60709	SAMD00016379	DRX000475	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000770/DRR000770.fastq.gz
PRJDA60709	SAMD00016383	DRX000476	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000771/DRR000771.fastq.gz
PRJDA60709	SAMD00016380	DRX000477	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000772/DRR000772.fastq.gz
PRJDA60709	SAMD00016378	DRX000478	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000773/DRR000773.fastq.gz
PRJDA60709	SAMD00016381	DRX000479	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000774/DRR000774.fastq.gz
PRJDA60709	SAMD00016382	DRX000480	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000775/DRR000775.fastq.gz
</code></pre></div></div>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-accessing-the-rule-based-uploader"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Accessing the Rule Based Uploader</h3>

  <ol>
    <li>
      <p><strong>Click</strong> the upload icon toward the top left corner.</p>

      <p>By default the familiar simple upload dialog should appear. This dialog has more advanced options as different tabs across the top of this dialog though.</p>
    </li>
    <li>
      <p><strong>Click</strong> <code class="highlighter-rouge">Rule-based</code> as shown below.</p>

      <p><img src="../../images/rules/rules_example_1_1_rules_landing.png" alt="screenshot" />
As you can see in this dialog, data can be selected from a history dataset or pasted in directly. If Galaxy is configured to allow FTP uploads, the contents of your FTP directory may be loaded directly as well.</p>
    </li>
    <li><strong>Paste</strong> your tabular data right into the textbox on this page as shown below
      <ul>
        <li><strong>Click</strong> the <code class="highlighter-rouge">Build</code> button.</li>
      </ul>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>study_accession	sample_accession	experiment_accession	fastq_ftp
PRJDA60709	SAMD00016379	DRX000475	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000770/DRR000770.fastq.gz
PRJDA60709	SAMD00016383	DRX000476	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000771/DRR000771.fastq.gz
PRJDA60709	SAMD00016380	DRX000477	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000772/DRR000772.fastq.gz
PRJDA60709	SAMD00016378	DRX000478	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000773/DRR000773.fastq.gz
PRJDA60709	SAMD00016381	DRX000479	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000774/DRR000774.fastq.gz
PRJDA60709	SAMD00016382	DRX000480	ftp.sra.ebi.ac.uk/vol1/fastq/DRR000/DRR000775/DRR000775.fastq.gz
</code></pre></div>      </div>

      <p><img src="../../images/rules/rules_example_1_2_paste.png" alt="screenshot" /></p>
    </li>
    <li>
      <p><strong>Examine</strong> the  the <code class="highlighter-rouge">rules editor</code> which now pops up.</p>

      <p><img src="../../images/rules/rules_example_1_3_initial_rules.png" alt="screenshot" /></p>
    </li>
  </ol>

</blockquote>

<p>At first glance, this may be feel like Excel or another spreadsheet program and you may feel the urge to start editing cells but we strongly encourage defining rules for manipulating the data instead. There are a few reasons for this:</p>

<ul>
  <li><strong>Manually modifying this metadata is not reproducible</strong> - we will not belabor the point here but check out <a href="/training-material/topics/introduction/tutorials/galaxy-intro-strands/tutorial.html#why-not-use-excel-for-this">Why not use excel for this?</a> for more context. Building up rules for modifying this metadata will allow Galaxy to track and report your manipulations (providing tracibility) and apply them to new sets of files (providing reproducibility).</li>
  <li><strong>Manually modifying this metadata is error prone</strong> - we believe defining rules and treating the metadata in a systematic way minimizes the possibility to manual errors. These errors can be very hard to detect for large sets of data.</li>
  <li><strong>Manually modifying data is not scalable</strong> - this rule-based technique potentially scales to importing tens of thousands of datasets.</li>
</ul>

<p>So rather than modifying the data, we will define rules for manipulating it and setting up “column definitions” that tell Galaxy how to use the metadata during upload or collection creation.</p>

<p>In order to get these files into Galaxy, we will want to do a few things:</p>
<ul>
  <li>Strip that header out of the data (it doesn’t contain a URL Galaxy can download).</li>
  <li>Define column <code class="highlighter-rouge">C</code> as the dataset name.</li>
  <li>Define column <code class="highlighter-rouge">D</code> as the dataset URL (this is the location Galaxy can download the data from).</li>
  <li>Tell Galaxy to treat these files as <code class="highlighter-rouge">fastqsanger.gz</code> files.</li>
</ul>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-using-tabular-inputs-to-the-rule-builder"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Using Tabular Inputs to the Rule Builder</h3>

  <p>We will start by stripping that header out of the table. We call rules that strip rows out the table <code class="highlighter-rouge">Filter rules</code> in this dialog.</p>

  <ol>
    <li>From <strong>Filter</strong> menu select <code class="highlighter-rouge">First or Last N Rows</code>
      <ul>
        <li><em>“Filter which rows?”</em>: <code class="highlighter-rouge">first</code></li>
        <li><em>“Filter how many rows?”</em>: <code class="highlighter-rouge">1</code></li>
        <li>Click <code class="highlighter-rouge">Apply</code>
<img src="../../images/rules/rules_example_1_4_filter_header.png" alt="screenshot" /></li>
      </ul>

      <p>Next we will define these columns for Galaxy.</p>
    </li>
    <li>From <strong>Rules</strong> menu select <code class="highlighter-rouge">Add / Modify Column Definitions</code>
      <ul>
        <li>Click <code class="highlighter-rouge">Add Definition</code> button and select <code class="highlighter-rouge">Name</code>
          <ul>
            <li><em>“Name”</em>: <code class="highlighter-rouge">C</code></li>
          </ul>
        </li>
        <li>Repeat this again and select <code class="highlighter-rouge">URL</code> instead.
          <ul>
            <li><em>“URL”</em>: <code class="highlighter-rouge">D</code></li>
          </ul>
        </li>
      </ul>

      <p><img src="../../images/rules/rules_example_1_5_mapping_edit.png" alt="screenshot" /></p>
    </li>
    <li>
      <p><strong>Click</strong> <code class="highlighter-rouge">Apply</code>, and you should see your new column definitions listed as in the following screenshot.
<img src="../../images/rules/rules_example_1_6_mapping_set.png" alt="screenshot" /></p>
    </li>
    <li><strong>Click</strong> the <code class="highlighter-rouge">Type</code> selection box at the bottom left of the upload dialog
      <ul>
        <li>Change the datatype from <code class="highlighter-rouge">Auto-detect</code> to <code class="highlighter-rouge">fastqsanger</code>.
<img src="../../images/rules/rules_example_1_7_extension_set.png" alt="screenshot" /></li>
      </ul>

      <p>You are now ready to start the upload</p>
    </li>
    <li>
      <p><strong>Click</strong> the <code class="highlighter-rouge">Upload</code> button</p>

      <p>After some time, the result in this case will be six datasets in your history. The next example will show to use the rule builder to create a collection.</p>
    </li>
  </ol>
</blockquote>

<h1 id="creating-a-simple-dataset-list">Creating a Simple Dataset List</h1>

<p>This example will demonstrate using such history datasets as the source for collection uploads - this can be handy when you’d like to apply existing Galaxy tabular manipulation tools to the metadata before processing for instance.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-creating-a-simple-dataset-list"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Creating a Simple Dataset List</h3>

  <blockquote class="tip">
    <h3 id="tip-tip-create-a-new-history"><i class="fa fa-lightbulb-o" aria-hidden="true"></i><span class="visually-hidden">tip</span> Tip: Create a new history</h3>
    <p>Before we start uploading, it may be a good idea to create a new history for this example to keep things simple and match the following screenshots.</p>
  </blockquote>

  <p>For our second example, we will use the same initial metadata.</p>

  <blockquote class="comment">
    <h3 id="comment-loading-metadata-from-a-history-element"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Loading Metadata from a History Element</h3>
    <p>In addition to directly pasting data into the Rule Based Uploader, you can also load the metadata from a dataset in your Galaxy History, or from a file in your FTP directory if the admin has enabled FTP upload</p>
  </blockquote>

  <ol>
    <li><strong>Upload</strong> the metadata from the <a href="#example-1-metadata">first example</a> to your Galaxy</li>
    <li><strong>Open</strong> the <code class="highlighter-rouge">Rule-based</code> upload tab again, but this time:
      <ul>
        <li><em>“Upload data as”</em>: <code class="highlighter-rouge">Collection(s)</code></li>
        <li><em>“Load tabular data from”</em>: <code class="highlighter-rouge">a History Dataset</code></li>
        <li><em>“Select dataset to load”</em>: the dataset you just uploaded
<img src="../../images/rules/rules_example_2_1_inputs.png" alt="screenshot" /></li>
      </ul>
    </li>
    <li><strong>Click</strong> <code class="highlighter-rouge">Build</code> to bring up the rule builder.
<img src="../../images/rules/rules_example_2_2_initial_rules.png" alt="screenshot" /></li>
    <li><strong>Repeat</strong> the steps from last time, except define column <code class="highlighter-rouge">C</code> as a <code class="highlighter-rouge">List Identifier</code> instead of Name:
      <ul>
        <li>From <strong>Filter</strong> menu select <code class="highlighter-rouge">First or Last N Rows</code>
          <ul>
            <li><em>“Filter which rows?”</em>: <code class="highlighter-rouge">first</code></li>
            <li><em>“Filter how many rows?”</em>: <code class="highlighter-rouge">1</code></li>
          </ul>
        </li>
        <li>From <strong>Rules</strong> menu, select <code class="highlighter-rouge">Add / Modify Column Definitions</code>
          <ul>
            <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">URL</code>, Select Column <code class="highlighter-rouge">D</code></li>
            <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">List Identifier(s)</code>, Column <code class="highlighter-rouge">C</code></li>
          </ul>
        </li>
        <li><em>“Type”</em>: <code class="highlighter-rouge">fastqsanger</code></li>
      </ul>

      <p><img src="../../images/rules/rules_example_2_3_rules.png" alt="screenshot" /></p>

      <p>Rather than assigning column <code class="highlighter-rouge">C</code> as <code class="highlighter-rouge">Name</code>, in this example we assigned it as a <code class="highlighter-rouge">List Identifier</code>. This is the description of the element in the resulting dataset collection. This identifier is preserved in mapped outputs as you map tools over collections and is useful for tracking sample names, replicate numbers, conditions, etc..</p>
    </li>
    <li><strong>Enter</strong> a name for our collection, for example the ENA study identifier as shown below, <code class="highlighter-rouge">PRJDA60709</code>.
<img src="../../images/rules/rules_example_2_4_name.png" alt="screenshot" /></li>
    <li>
      <p><strong>Click</strong> <code class="highlighter-rouge">Upload</code></p>

      <p>This time a single new entry will appear in your history panel corresponding to all the files gathered together in a simple list named <strong>PRJDA60709</strong>.</p>
    </li>
  </ol>
</blockquote>

<h1 id="creating-a-list-of-dataset-pairs">Creating a List of Dataset Pairs</h1>

<p>For this next example we will again use ENA data, this time corresponding to the study <a href="https://www.ebi.ac.uk/ena/data/view/PRJDB3920">PRJDB3920</a> instead.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-creating-a-list-of-dataset-pairs"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Creating a List of Dataset Pairs</h3>

  <ol>
    <li>
      <p><strong>Open</strong> the Rule Builder</p>
    </li>
    <li><strong>Open</strong> the <code class="highlighter-rouge">Rule-based</code> upload tab again, but this time:
      <ul>
        <li><em>“Upload data as”</em>: Collection(s)</li>
        <li><em>“Load tabular data from”</em>: a <code class="highlighter-rouge">Pasted Table</code></li>
        <li>
          <p><strong>Paste</strong> the following table</p>

          <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>study_accession	sample_accession	experiment_accession	fastq_ftp
PRJDB3920	SAMD00034150	DRX036147	ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039919/DRR039919_1.fastq.gz;ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039919/DRR039919_2.fastq.gz
PRJDB3920	SAMD00034150	DRX036148	ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039920/DRR039920_1.fastq.gz;ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039920/DRR039920_2.fastq.gz
PRJDB3920	SAMD00034150	DRX036149	ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039921/DRR039921_1.fastq.gz;ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039921/DRR039921_2.fastq.gz
PRJDB3920	SAMD00034150	DRX036150	ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039922/DRR039922_1.fastq.gz;ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039922/DRR039922_2.fastq.gz
PRJDB3920	SAMD00034150	DRX036151	ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039923/DRR039923_1.fastq.gz;ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039923/DRR039923_2.fastq.gz
PRJDB3920	SAMD00034153	DRX036152	ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039924/DRR039924_1.fastq.gz;ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039924/DRR039924_2.fastq.gz
PRJDB3920	SAMD00034152	DRX036164	ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039936/DRR039936_1.fastq.gz;ftp.sra.ebi.ac.uk/vol1/fastq/DRR039/DRR039936/DRR039936_2.fastq.gz
</code></pre></div>          </div>
        </li>
      </ul>
    </li>
    <li>
      <p><strong>Click</strong> <code class="highlighter-rouge">Build</code> and proceed to the rule builder.
<img src="../../images/rules/rules_example_3_2_initial_rules.png" alt="screenshot" /></p>
    </li>
    <li><strong>Repeat</strong> the last example with:
      <ul>
        <li>From <strong>Filter</strong> menu select <code class="highlighter-rouge">First or Last N Rows</code>
          <ul>
            <li><em>“Filter which rows?”</em>: <code class="highlighter-rouge">first</code></li>
            <li><em>“Filter how many rows?”</em>: <code class="highlighter-rouge">1</code></li>
          </ul>
        </li>
        <li>From <strong>Rules</strong> menu, select <code class="highlighter-rouge">Add / Modify Column Definitions</code>
          <ul>
            <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">List Identifier(s)</code>, Column <code class="highlighter-rouge">C</code></li>
          </ul>
        </li>
        <li><em>“Type”</em>: <code class="highlighter-rouge">fastqsanger</code></li>
      </ul>

      <p>In this dataset, column <code class="highlighter-rouge">D</code> contains two URLs, separated by a semicolon <code class="highlighter-rouge">;</code>. So we cannot define that column as the URL directly, we will need to split it into two columns first.
We will build a regular expression that captures two “groups” from this column with two URLs - one group for everything before the <code class="highlighter-rouge">;</code> and one group for everything after.</p>
    </li>
    <li>From <strong>Column</strong>, select <code class="highlighter-rouge">Using a Regular Expression</code>
      <ul>
        <li><em>“From Column”</em>: <code class="highlighter-rouge">D</code></li>
        <li>Select <code class="highlighter-rouge">Create columns matching expression groups</code></li>
        <li><em>“Regular Expression”</em>: <code class="highlighter-rouge">(.*);(.*)</code></li>
        <li><em>“Number of Groups”</em>: <code class="highlighter-rouge">2</code>
<img src="../../images/rules/rules_example_3_4_regex.png" alt="screenshot" /></li>
      </ul>

      <blockquote class="comment">
        <h3 id="comment-regular-expression-explained"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Regular expression explained</h3>
        <p>Here <code class="highlighter-rouge">.*</code> means match any number of any character - so basically match anything.
The parentheses around <code class="highlighter-rouge">.*</code> means form a “group” from whatever is matched. The <code class="highlighter-rouge">;</code> will match with the actual <code class="highlighter-rouge">;</code> in the target cells.
In his example we have two such matching groups.</p>
      </blockquote>
    </li>
    <li>
      <p>Click <strong>Apply</strong> to apply the regular expression to the metadata table</p>

      <p>Column <code class="highlighter-rouge">D</code> is no longer needed, so we can remove it:</p>
    </li>
    <li>From <strong>Rules</strong> select <code class="highlighter-rouge">Remove Column(s)</code>
      <ul>
        <li><em>“From Column”</em>: <code class="highlighter-rouge">D</code>
<img src="../../images/rules/rules_example_3_7_removed_column.png" alt="screenshot" /></li>
      </ul>

      <p>We now have two columns containing URLs - but we can only have one URL per row. So we will split each row into two (one for the forward reads and one for the reverse):</p>
    </li>
    <li>From <strong>Rules</strong> select <code class="highlighter-rouge">Split Column(s)</code>
      <ul>
        <li><em>“Odd Row Column(s)”</em>: <code class="highlighter-rouge">D</code></li>
        <li><em>“Even Row Column(s)”</em>: <code class="highlighter-rouge">E</code></li>
        <li>Click <code class="highlighter-rouge">Apply</code></li>
      </ul>

      <p><img src="../../images/rules/rules_example_3_9_columns_are_split.png" alt="screenshot" />
For every row before the transformation with columns <code class="highlighter-rouge">ABCDE</code>, this will produce two rows, <code class="highlighter-rouge">ABCD</code> and <code class="highlighter-rouge">ABCE</code>. Thus you will have twice as many rows as before.
<br /><br />
Now we need to inform Galaxy which of these rows are “forward” reads and which are “reverse” reads. We will do this by adding a new column again using a regular expression. Here we will match on the <code class="highlighter-rouge">_1</code> or <code class="highlighter-rouge">_2</code> in the filename at the end of the URLs.</p>
    </li>
    <li>From <strong>Column</strong>, select <code class="highlighter-rouge">Using a Regular Expression</code>
      <ul>
        <li><em>“Column”</em>: <code class="highlighter-rouge">D</code></li>
        <li>Select <code class="highlighter-rouge">Create columns matching expression groups</code></li>
        <li><em>“Regular Expression”</em>: <code class="highlighter-rouge">.*_(\d).fastq.gz</code>.</li>
        <li><em>“Number of groups”</em>: <code class="highlighter-rouge">1</code>
<img src="../../images/rules/rules_example_3_10_regex_paired.png" alt="screenshot" /></li>
      </ul>

      <blockquote class="comment">
        <h3 id="comment-regular-expression-explained-1"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Regular expression explained</h3>
        <p>Here <code class="highlighter-rouge">\d</code> means match any digit. This regular expression will use a capturing group to select only the <code class="highlighter-rouge">1</code> or <code class="highlighter-rouge">2</code> part of the URL that appears before the extension.
In his example we have one matching groups ( contained in the parentheses )</p>
      </blockquote>

      <p>At this point, you can swap the last two columns to bring this new paired indicator column toward the beginning of the table. This is not necessary but it makes the screenshots more informative.</p>
    </li>
    <li>From <strong>Rule</strong> select <code class="highlighter-rouge">Swap Columns</code>
      <ul>
        <li><em>“Swap Column”</em>: <code class="highlighter-rouge">D</code></li>
        <li><em>“With Column”</em>: <code class="highlighter-rouge">E</code></li>
      </ul>
    </li>
    <li><strong>Open</strong> the column definitions back up (<strong>Rules</strong> Menu, <code class="highlighter-rouge">Add / Modify Column Definitions</code>)
      <ul>
        <li><em>“paired indicator”</em>: column <code class="highlighter-rouge">D</code></li>
        <li><em>“URL”</em>: column <code class="highlighter-rouge">E</code></li>
      </ul>

      <blockquote class="comment">
        <h3 id="comment-paired-indicator-column-definition"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Paired Indicator Column Definition</h3>
        <p>The column selector for paired indicator is a bit less obvious and a bit more picky than the other ones we have used. The row value of the paired indicator column must be one of the following to indicate “forward” or “reverse” reads.</p>

        <table>
          <thead>
            <tr>
              <th>Column</th>
              <th>Acceptable Indicators</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Forward</td>
              <td><code class="highlighter-rouge">1</code>, <code class="highlighter-rouge">R1</code>, <code class="highlighter-rouge">forward</code>, <code class="highlighter-rouge">f</code>, or <code class="highlighter-rouge">F</code></td>
            </tr>
            <tr>
              <td>Reverse</td>
              <td><code class="highlighter-rouge">2</code>, <code class="highlighter-rouge">R2</code>, <code class="highlighter-rouge">reverse</code>, <code class="highlighter-rouge">r</code>, or <code class="highlighter-rouge">R</code></td>
            </tr>
          </tbody>
        </table>
      </blockquote>
    </li>
    <li><strong>Supply</strong> a name for your collection and click <strong>Upload</strong>
<img src="../../images/rules/rules_example_3_14_paired_identifier_set.png" alt="screenshot" /></li>
  </ol>

</blockquote>

<h1 id="building-urls-from-accession-information">Building URLs from Accession Information</h1>

<p>In the previous examples the metadata we started with already contained URLs. In some cases such URLs will not be present in the available metadata and may need to be constructed dynamically from identifiers.</p>

<p>For this multiomics example, we will start with a uniprot query and build URLs from accession numbers contained within the supplied tabular data. Consider the uniprot query <a href="https://uniprot.org/uniprot/?query=proteome:UP000052092+AND+proteomecomponent:%22Genome%22">https://uniprot.org/uniprot/?query=proteome:UP000052092+AND+proteomecomponent:”Genome”</a>, pictured below.</p>

<p><img src="../../images/rules/uniprot_url.png" alt="UniProt table screenshot" /></p>

<p>In order to make this data useful for the Rule Builder, we need to turn these accessoin IDs into URLs.</p>

<blockquote class="hands_on" id="example-3-metadata">
  <h3 id="hands_on-hands-on-turn-uniprot-accession-ids-into-urls"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Turn Uniprot Accession IDs into URLs</h3>

  <ol>
    <li>Open <a href="https://www.uniprot.org/uniprot/E7C0H6">Uniprot</a></li>
    <li><strong>Click</strong> on one of the entries in the table (e.g. <code class="highlighter-rouge">E7C0H6</code>)</li>
    <li><strong>Select</strong> <code class="highlighter-rouge">Format</code> from the top menu</li>
    <li>
      <p><strong>Click</strong> <code class="highlighter-rouge">FASTA (canonical)</code></p>

      <p><img src="../../images/rules/uniprot_fasta.png" alt="Link to access FASTA file" /></p>
    </li>
    <li>
      <p>Your browser will redirect to the fasta file</p>

      <p><img src="../../images/rules/uniprot_fasta_url.png" alt="Viewing the FASTA file" /></p>
    </li>
    <li>We can deduce that the FASTA files for the other accession IDs will be available from URLs of the form <code class="highlighter-rouge">https://www.uniprot.org/uniprot/{identifier}.fasta</code></li>
  </ol>

</blockquote>

<p>We will use this information to build a collection of FASTA files from our query.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-build-collection-from-uniprot-accession-ids"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Build Collection from Uniprot Accession IDs</h3>

  <ol>
    <li>Open the Rule Builder
      <ul>
        <li><em>“Upload data as”</em>: <code class="highlighter-rouge">Collection(s)</code></li>
        <li><em>“Load tabular data from”</em>: <code class="highlighter-rouge">Pasted Table</code></li>
        <li>
          <p><strong>Paste</strong> the following table:</p>

          <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Entry	Entry name	Status	Protein names	Gene names	Organism	Length
E7C0H6	E7C0H6_9PAPI	unreviewed	Major capsid protein L1	L1	Equus caballus papillomavirus 3	498
E7C0H0	E7C0H0_9PAPI	unreviewed	Protein E6	E6	Equus caballus papillomavirus 3	150
E7C0H5	E7C0H5_9PAPI	unreviewed	Minor capsid protein L2	L2	Equus caballus papillomavirus 3	498
E7C0H1	E7C0H1_9PAPI	unreviewed	Protein E7		Equus caballus papillomavirus 3	93
E7C0H3	E7C0H3_9PAPI	unreviewed	Regulatory protein E2	E2	Equus caballus papillomavirus 3	421
E7C0H4	E7C0H4_9PAPI	unreviewed	Putative E4 early protein (Fragment)		Equus caballus papillomavirus 3	175
E7C0H2	E7C0H2_9PAPI	unreviewed	Replication protein E1 (EC 3.6.4.12) (ATP-dependent helicase E1)	E1	Equus caballus papillomavirus 3	621
</code></pre></div>          </div>
        </li>
        <li>Click <code class="highlighter-rouge">Build</code>
<img src="../../images/rules/rules_example_4_2_initial_rules.png" alt="screenshot" /></li>
      </ul>
    </li>
    <li>Let’s apply some initial filtering to our data:
      <ul>
        <li>From <strong>Filter</strong> menu, select <code class="highlighter-rouge">First or Last N Rows</code>
          <ul>
            <li>Filter the first row</li>
          </ul>
        </li>
        <li>From <strong>Rules</strong> menu, select  <code class="highlighter-rouge">Remove Columns</code>
          <ul>
            <li>Remove columns B, C, E, F, and G.</li>
          </ul>
        </li>
        <li>From <strong>Rules</strong> menu, select  <code class="highlighter-rouge">Add / Modify Column Definitions</code>
          <ul>
            <li>
              <p>Click <code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">Info</code>, Column <code class="highlighter-rouge">B</code></p>

              <p>This is a block of text that will appear in the history panel when the dataset is expanded.
<img src="../../images/rules/rules_example_4_3_basic_rules.png" alt="screenshot" /></p>
            </li>
          </ul>
        </li>
      </ul>

      <p>These datasets appear in a seemingly random order, it will be easier to manage things in the history panel if we sort this data first.
<img src="../../images/rules/rules_example_4_4_sort.png" alt="screenshot" /></p>
    </li>
    <li>From <strong>Rules</strong> menu, select <code class="highlighter-rouge">Sort</code>
      <ul>
        <li><em>“From Column”</em>: <code class="highlighter-rouge">A</code></li>
      </ul>

      <p>Next is the key step, we will build a URL from the pattern we described above using the accession ID in column A.</p>
    </li>
    <li>From <strong>Column</strong> menu, select <code class="highlighter-rouge">Using a Regular Expression</code>
      <ul>
        <li><em>“From Column”</em>: <code class="highlighter-rouge">A</code></li>
        <li>Select <code class="highlighter-rouge">Create column from expression replacement</code></li>
        <li><em>“Regular Expression”</em>: <code class="highlighter-rouge">.*</code></li>
        <li><em>“Replacement Expression”</em>: <code class="highlighter-rouge">https://www.uniprot.org/uniprot/\0.fasta</code></li>
        <li>
          <p>Click <code class="highlighter-rouge">Apply</code></p>

          <p><img src="../../images/rules/rules_example_4_5_url.png" alt="screenshot" /></p>
        </li>
      </ul>

      <blockquote class="comment">
        <h3 id="comment-regular-expression-explained-2"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Regular expression explained</h3>
        <p>In this regular expression, <code class="highlighter-rouge">.*</code> will capture the entire accession ID.</p>

        <p>In the replacement expression, <code class="highlighter-rouge">https://www.uniprot.org/uniprot/\0.fasta</code>, the <code class="highlighter-rouge">\0</code> will be replaced by the captured
regular expression (the accession ID) in the resulting column values.</p>
      </blockquote>

      <p>The new column C with the URL we built should appear as shown below.
<img src="../../images/rules/rules_example_4_6_url_built.png" alt="screenshot" /></p>

      <p>Finally, let us set our column definitions:</p>
    </li>
    <li>From <strong>Rules</strong> menu, select <code class="highlighter-rouge">Add / Modify Column Definitions</code>
      <ul>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">List Identifier(s)</code>, Select Column <code class="highlighter-rouge">A</code></li>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">URL</code>, Column <code class="highlighter-rouge">C</code></li>
      </ul>
    </li>
    <li>Finalize the collection:
      <ul>
        <li><em>“Name”</em>: for example <code class="highlighter-rouge">UP000052092</code></li>
        <li><em>“Type”</em>: <code class="highlighter-rouge">fasta</code></li>
        <li>Click <code class="highlighter-rouge">Upload</code>
<img src="../../images/rules/rules_example_4_7_mapping_extension_and_name.png" alt="screenshot" /></li>
      </ul>

      <blockquote class="comment">
        <h3 id="comment-json-rule-definitions"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> JSON Rule Definitions</h3>
        <p>This example is ready to go, but before clicking “Build” it may be interesting to check out the rules Galaxy is following to clean and import your data. Click the little Wrench icon at the top of the list of rules. The result is a bunch of JavaScript object notation (JSON) text that you should never need to worry about but that you can build or modify by hand if you find it useful. We will use it the next example to quickly restore the list builder back to this state.</p>

        <p><img src="../../images/rules/rules_example_4_8_source.png" alt="screenshot" /></p>

        <p>This could additionally be copied and pasted if you need to do the same set of operations on multiple metadata inputs that are similarly formatted.</p>
      </blockquote>
    </li>
    <li>Click <code class="highlighter-rouge">Build</code> and wait for your list of FASTA files to appear.</li>
  </ol>
</blockquote>

<h1 id="building-matched-collections">Building Matched Collections</h1>

<p>This example will demonstrate creating multiple collections at the same time. We will use the same metadata generated from UniProt as the last example but we will build two collections with matching list identifiers - one collection of FASTA files and one collection of GFF files. This will also demonstrate reading the collection name and the target datatype from the metadata itself - important techniques if generating multiple collections with different names and datatypes.</p>

<p>For this example we will re-use the metadata from the <a href="#example-3-metadata">previous example</a>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-build-a-matched-collection"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Build a matched collection</h3>

  <ol>
    <li><strong>Open</strong> the Rule Builder
      <ul>
        <li><em>“Upload data as”</em>: <code class="highlighter-rouge">Collection(s)</code></li>
        <li><em>“Load tabular data from”</em>: <code class="highlighter-rouge">Pasted Table</code></li>
        <li>Paste the table from the previous exercise:
          <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Entry	Entry name	Status	Protein names	Gene names	Organism	Length
E7C0H6	E7C0H6_9PAPI	unreviewed	Major capsid protein L1	L1	Equus caballus papillomavirus 3	498
E7C0H0	E7C0H0_9PAPI	unreviewed	Protein E6	E6	Equus caballus papillomavirus 3	150
E7C0H5	E7C0H5_9PAPI	unreviewed	Minor capsid protein L2	L2	Equus caballus papillomavirus 3	498
E7C0H1	E7C0H1_9PAPI	unreviewed	Protein E7		Equus caballus papillomavirus 3	93
E7C0H3	E7C0H3_9PAPI	unreviewed	Regulatory protein E2	E2	Equus caballus papillomavirus 3	421
E7C0H4	E7C0H4_9PAPI	unreviewed	Putative E4 early protein (Fragment)		Equus caballus papillomavirus 3	175
E7C0H2	E7C0H2_9PAPI	unreviewed	Replication protein E1 (EC 3.6.4.12) (ATP-dependent helicase E1)	E1	Equus caballus papillomavirus 3	621
</code></pre></div>          </div>
        </li>
        <li>Click <code class="highlighter-rouge">Build</code> and proceed to the rule builder.
<img src="../../images/rules/rules_example_5_1_inputs.png" alt="screenshot" /></li>
      </ul>
    </li>
    <li>
      <p>Instead of manually creating the rules this time, we will import an existing set of rules from some JSON. Copy the following text into your clipboard. These are the same rules as used in the <a href="#building-urls-from-accession-information">Building URLs from Accession Information</a> tutorial.</p>

      <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s2">"rules"</span><span class="p">:[{</span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"add_filter_count"</span><span class="p">,</span><span class="s2">"count"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="s2">"which"</span><span class="p">:</span><span class="s2">"first"</span><span class="p">,</span><span class="s2">"invert"</span><span class="p">:</span><span class="kc">false</span><span class="p">},{</span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"remove_columns"</span><span class="p">,</span><span class="s2">"target_columns"</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]},{</span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"sort"</span><span class="p">,</span><span class="s2">"target_column"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">"numeric"</span><span class="p">:</span><span class="kc">false</span><span class="p">},{</span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"add_column_regex"</span><span class="p">,</span><span class="s2">"target_column"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">"expression"</span><span class="p">:</span><span class="s2">".*"</span><span class="p">,</span><span class="s2">"replacement"</span><span class="p">:</span><span class="s2">"http://www.uniprot.org/uniprot/</span><span class="se">\\</span><span class="s2">0.fasta"</span><span class="p">}],</span><span class="s2">"mapping"</span><span class="p">:[{</span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span><span class="s2">"columns"</span><span class="p">:[</span><span class="mi">1</span><span class="p">]},{</span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"list_identifiers"</span><span class="p">,</span><span class="s2">"columns"</span><span class="p">:[</span><span class="mi">0</span><span class="p">],</span><span class="s2">"editing"</span><span class="p">:</span><span class="kc">false</span><span class="p">},{</span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"url"</span><span class="p">,</span><span class="s2">"columns"</span><span class="p">:[</span><span class="mi">2</span><span class="p">]}],</span><span class="s2">"extension"</span><span class="p">:</span><span class="s2">"csfasta"</span><span class="p">}</span><span class="w">
</span></code></pre></div>      </div>
    </li>
    <li>In the ruler builder interface, select the <strong>wrench icon</strong> next to the word <code class="highlighter-rouge">Rules</code>
      <ul>
        <li>Paste the rules into the textbox</li>
        <li>Click <code class="highlighter-rouge">Apply</code></li>
      </ul>

      <p><img src="../../images/rules/rules_example_5_2_source.png" alt="screenshot" /></p>

      <p>You should now see the rules you created in the last example.
<img src="../../images/rules/rules_example_5_3_initial_rules.png" alt="screenshot" /></p>

      <p>This next part may seem a bit silly at first but we are going to add some columns with fixed values into the builder. When we split up the columns at a later step this will make sense.</p>
    </li>
    <li>From <strong>Column</strong> menu, select  <code class="highlighter-rouge">Fixed Value</code>
      <ul>
        <li><em>“Value”</em>: <code class="highlighter-rouge">fasta</code></li>
        <li>Click <code class="highlighter-rouge">Apply</code>
This value will eventually be used for the datatype of the file.</li>
      </ul>
    </li>
    <li><strong>Repeat</strong> this process with:
      <ul>
        <li><em>“Value”</em>:<code class="highlighter-rouge">UP000052092 FASTA</code></li>
      </ul>

      <p>Next we will repeat the process of adding URL, name, and datatype columns but for GFF files.</p>
    </li>
    <li>From <strong>Column</strong>, select <code class="highlighter-rouge">Using a Regular Expression</code>
      <ul>
        <li><em>“From Column”</em>: <code class="highlighter-rouge">A</code></li>
        <li>Select <code class="highlighter-rouge">Create column from expression replacement</code></li>
        <li><em>“Regular Expression”</em>: <code class="highlighter-rouge">.*</code></li>
        <li><em>“Replacement Expression”</em>: <code class="highlighter-rouge">https://www.uniprot.org/uniprot/\0.gff</code>.
 <img src="../../images/rules/rules_example_5_5_url.png" alt="screenshot" /></li>
      </ul>

      <p>Next we will add two more columns</p>
    </li>
    <li>From <strong>Column</strong> menu, select  <code class="highlighter-rouge">Fixed Value</code>
      <ul>
        <li><em>“Value”</em>: <code class="highlighter-rouge">gff3</code></li>
        <li>Click <code class="highlighter-rouge">Apply</code></li>
      </ul>

      <p>This value will eventually be used for the datatype of the file.</p>
    </li>
    <li><strong>Repeat</strong> this process with:
      <ul>
        <li><em>“Value”</em>: <code class="highlighter-rouge">UP000052092 GFF3</code></li>
      </ul>

      <p>Your very large list of rules should now look like the following screenshot.
<img src="../../images/rules/rules_example_5_6_presplit.png" alt="screenshot" /></p>

      <p>Notice we have two URLs, two collection names, and two datatype extensions for each accession ID we started with. Like in the example where we split the columns, here we will split these up to describe multiple collections.</p>
    </li>
    <li>From <strong>Rules</strong> menu, select  <code class="highlighter-rouge">Split Columns</code>
      <ul>
        <li><em>“Odd Number Column(s)”</em>: <code class="highlighter-rouge">C</code>, <code class="highlighter-rouge">D</code>, and <code class="highlighter-rouge">E</code> (the fasta columns)</li>
        <li><em>“Even Number Column(s)”</em>: <code class="highlighter-rouge">F</code>, <code class="highlighter-rouge">G</code>, and <code class="highlighter-rouge">H</code> (the gff3 columns)</li>
      </ul>

      <p>This will take the row consisting of the columns <code class="highlighter-rouge">ABCDEFGH</code> and build two rows, one with <code class="highlighter-rouge">ABCDEF</code> and the other with <code class="highlighter-rouge">ABFGH</code>
<img src="../../images/rules/rules_example_5_7_split_columns.png" alt="screenshot" /></p>
    </li>
    <li>
      <p>Click <code class="highlighter-rouge">Apply</code> and you should be returned the list of rules.
<img src="../../images/rules/rules_example_5_8_split.png" alt="screenshot" /></p>

      <p>Finally, we need to add some more column definitions for these new columns we just created:</p>
    </li>
    <li>From <strong>Rules</strong> menu, select <code class="highlighter-rouge">Add / Modify Column Definitions</code>
      <ul>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">List Identifier</code>, Column <code class="highlighter-rouge">A</code></li>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">Info</code>, Column <code class="highlighter-rouge">B</code></li>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">URL</code>, Column <code class="highlighter-rouge">C</code></li>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">Type</code>, Column <code class="highlighter-rouge">D</code></li>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">Collection Name</code>, Column <code class="highlighter-rouge">E</code></li>
      </ul>

      <p>Notice when these values are being generated from the metadata the option to specify them manually from the <strong>type</strong> and <strong>collection name</strong> boxes from the bottom of the form disappear.
<img src="../../images/rules/rules_example_5_9_mapping.png" alt="screenshot" /></p>
    </li>
    <li>
      <p>Click <code class="highlighter-rouge">Upload</code></p>

      <p>Galaxy should make two collections - one containing FASTA files and one containing GFF3 files.</p>
    </li>
  </ol>

</blockquote>

<h1 id="building-nested-lists">Building Nested Lists</h1>

<p>In this example, we will be building a nested list using data from <a href="https://www.ncbi.nlm.nih.gov/sra">SRA</a>. This is a more sophisticated structure for organizing datasets in Galaxy. In the above examples we organized datasets into simple lists with a single “list identifier” describing the files in the collection. Galaxy allows lists to be organized into nested lists - where each level of the list has an identifier.</p>

<p>If two such identifiers are present, this is a list of lists (called <code class="highlighter-rouge">list:list</code> in the workflow editor). In such a structure the outer identifiers (or first level of identifiers) may describe sample names and the inner identifiers (or second level) may describe replicates. Alternative the outer identifiers may describe conditions and the inner identifiers may describe individual samples. The structure of such collections should ideally be dictated by the study design.</p>

<p>If certain parts of your analysis require benefit from datasets being nested this way while other parts require feeding you data to a Galaxy tool all together without such a structure, then it is probably best to go ahead and build nested lists at the start of your analysis and then use the “Flatten Collection” tool on the resulting collection or a derivative collection to get the flat structure needed by certain tools in certain parts of your analysis.</p>

<p>For this example, we will describe analyzing the metadata of the <a href="https://www.ncbi.nlm.nih.gov/sra?term=PRJNA355367&amp;cmd=DetailsSearch">SRA project PRJNA355367</a>. Unlike the other examples, these SRA files are relatively large and not ideal for training purposes. So we’ve pre-downloaded the project metadata and replaced all the links with simple text files that should download really quickly - the <a href="./PRJNA355367.tsv">result is here</a>.</p>

<p>So use either the SRA exporter tool or download the CSV file with fake URLs. If you download the data from the SRA exporter tool, select only the first 12 columns from the data (up to the column labeled “Library Name”) and copy the resulting data to your clipboard.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-building-nested-lists"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Building Nested Lists</h3>

  <ol>
    <li>Open the Rule Builder
      <ul>
        <li><em>“Upload data as”</em>: <code class="highlighter-rouge">Collection(s)</code></li>
        <li><em>“Load tabular data from”</em>: <code class="highlighter-rouge">Pasted Table</code></li>
        <li>Paste the table</li>
      </ul>

      <blockquote class="solution">
        <h3 id="solution-show-table"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Show Table</h3>

        <p>Below is the table with pre-downloaded example data mentioned above:</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Run	ReleaseDate	LoadDate	spots	bases	spots_with_mates	avgLength	size_MB	AssemblyName	download_path	Experiment	LibraryName
SRR5363633	2017-03-21 11:40:07	2017-03-21 11:29:13	9942851	1993124486	9791175	200	809	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363633	SRX2659078	wtPA14
SRR5363634	2017-03-21 13:19:08	2017-03-21 13:17:11	1158307	232298840	1141697	200	81	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363634	SRX2659079	con10
SRR5363635	2017-03-21 13:19:08	2017-03-21 13:16:39	1270067	254490549	1249658	200	89	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363635	SRX2659080	con9
SRR5363636	2017-03-21 13:19:08	2017-03-21 13:16:56	1023725	205709452	1013013	200	74	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363636	SRX2659081	con8
SRR5363637	2017-03-21 11:37:06	2017-03-21 11:28:00	3179821	638410351	3141113	200	216	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363637	SRX2659082	con7
SRR5363638	2017-03-21 12:53:08	2017-03-21 12:04:58	3359498	675138344	3325080	200	288	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363638	SRX2659083	con6
SRR5363639	2017-03-21 13:19:08	2017-03-21 13:17:25	2074389	416191247	2046343	200	145	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363639	SRX2659084	con5
SRR5363640	2017-03-21 13:19:08	2017-03-21 13:17:46	2692438	540402576	2658118	200	187	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363640	SRX2659085	con4
SRR5363641	2017-03-21 13:19:08	2017-03-21 13:17:14	2271913	456015568	2243122	200	161	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363641	SRX2659086	con3
SRR5363642	2017-03-21 13:19:08	2017-03-21 13:16:58	2164949	434399488	2136063	200	151	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363642	SRX2659087	con2
SRR5363643	2017-03-21 11:37:06	2017-03-21 11:27:34	1999861	401313700	1973567	200	140	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363643	SRX2659088	con1
SRR5363644	2017-03-21 11:44:06	2017-03-21 11:36:06	13473203	2704705108	13306228	200	1076	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363644	SRX2659089	str10
SRR5363645	2017-03-21 11:37:06	2017-03-21 11:27:24	1801962	362038363	1782599	200	130	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363645	SRX2659090	str9
SRR5363646	2017-03-21 11:36:06	2017-03-21 11:26:22	39113	7861711	39106	200	4	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363646	SRX2659091	str8
SRR5363647	2017-03-21 11:36:06	2017-03-21 11:26:43	1255569	252289127	1242359	200	90	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363647	SRX2659092	str7
SRR5363648	2017-03-21 11:36:06	2017-03-21 11:26:42	903374	181362535	892308	200	64	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363648	SRX2659093	str6
SRR5363649	2017-03-21 11:37:06	2017-03-21 11:27:05	2059145	413598822	2035919	200	140	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363649	SRX2659094	str5
SRR5363650	2017-03-21 11:37:06	2017-03-21 11:27:37	1685689	338152407	1662375	200	119	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363650	SRX2659095	str4
SRR5363651	2017-03-21 11:36:06	2017-03-21 11:26:51	698470	140689157	694502	201	48	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363651	SRX2659096	str3
SRR5363652	2017-03-21 11:37:06	2017-03-21 11:27:53	755393	152119594	750753	201	52	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363652	SRX2659097	str2
SRR5363653	2017-03-21 11:37:06	2017-03-21 11:27:41	1651613	331529685	1630882	200	119	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363653	SRX2659098	str1
SRR5363654	2017-03-21 11:37:06	2017-03-21 11:27:37	1693765	340003252	1672625	200	118	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363654	SRX2659099	gen10
SRR5363655	2017-03-21 11:37:06	2017-03-21 11:28:30	2173449	436124391	2144642	200	153	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363655	SRX2659100	gen9
SRR5363656	2017-03-21 11:43:06	2017-03-21 11:33:05	9625215	1933561588	9519090	200	778	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363656	SRX2659101	gen8
SRR5363657	2017-03-21 11:37:06	2017-03-21 11:27:38	1106350	222126014	1092932	200	79	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363657	SRX2659102	gen7
SRR5363658	2017-03-21 11:37:07	2017-03-21 11:27:07	565475	113765064	560920	201	42	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363658	SRX2659103	gen6
SRR5363659	2017-03-21 11:37:07	2017-03-21 11:28:20	1320926	265553033	1308329	201	96	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363659	SRX2659104	gen5
SRR5363660	2017-03-21 11:37:07	2017-03-21 11:28:18	949047	190786413	939940	201	70	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363660	SRX2659105	gen4
SRR5363661	2017-03-21 11:39:07	2017-03-21 11:29:11	1609659	323469152	1593027	200	116	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363661	SRX2659106	gen3
SRR5363662	2017-03-21 11:37:07	2017-03-21 11:28:20	1244105	249942443	1230587	200	90	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363662	SRX2659107	gen2
SRR5363663	2017-03-21 11:44:06	2017-03-21 11:34:00	13546763	2714292352	13327595	200	1112	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363663	SRX2659108	gen1
SRR5363664	2017-03-21 11:37:07	2017-03-21 11:28:35	1995417	400617217	1971115	200	140	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363664	SRX2659109	pit9
SRR5363665	2017-03-21 11:39:07	2017-03-21 11:29:18	2098280	421450493	2074524	200	146	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363665	SRX2659110	pit10
SRR5363666	2017-03-21 11:39:07	2017-03-21 11:28:56	1624164	326200210	1605561	200	115	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363666	SRX2659111	pit8
SRR5363667	2017-03-21 11:39:07	2017-03-21 11:28:56	1765896	355178220	1750742	201	122	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363667	SRX2659112	pit7
SRR5363668	2017-03-21 11:39:07	2017-03-21 11:29:36	834144	167643900	825708	200	59	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363668	SRX2659113	pit6
SRR5363669	2017-03-21 11:42:06	2017-03-21 11:31:07	9524989	1913263017	9418320	200	780	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363669	SRX2659114	pit5
SRR5363670	2017-03-21 11:39:07	2017-03-21 11:28:48	1196456	240479817	1184548	200	84	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363670	SRX2659115	pit4
SRR5363671	2017-03-21 11:39:07	2017-03-21 11:29:21	1703068	341745049	1680568	200	119	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363671	SRX2659116	pit3
SRR5363672	2017-03-21 11:40:07	2017-03-21 11:29:21	1752519	352259586	1735224	201	122	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363672	SRX2659117	pit2
SRR5363673	2017-03-21 11:37:07	2017-03-21 11:28:40	1702102	341794907	1682027	200	121	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363673	SRX2659118	pit1
SRR5363674	2017-03-21 11:37:07	2017-03-21 11:28:41	2186337	438861929	2158858	200	155	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363674	SRX2659119	car10
SRR5363675	2017-03-21 11:37:07	2017-03-21 11:28:37	1806341	362679360	1784566	200	128	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363675	SRX2659120	car9
SRR5363676	2017-03-21 11:37:07	2017-03-21 11:28:29	1492644	299621613	1473926	200	106	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363676	SRX2659121	car8
SRR5363677	2017-03-21 11:40:07	2017-03-21 11:29:02	2139706	429729175	2115063	200	151	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363677	SRX2659122	car7
SRR5363678	2017-03-21 11:40:07	2017-03-21 11:29:13	1787521	358790286	1764881	200	124	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363678	SRX2659123	car6
SRR5363679	2017-03-21 11:38:06	2017-03-21 11:28:48	1500378	300767719	1477539	200	106	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363679	SRX2659124	car5
SRR5363680	2017-03-21 11:38:06	2017-03-21 11:28:54	879242	176495860	868255	200	63	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363680	SRX2659125	car4
SRR5363681	2017-03-21 11:40:07	2017-03-21 11:30:02	1852256	371663665	1827605	200	130	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363681	SRX2659126	car3
SRR5363682	2017-03-21 11:40:07	2017-03-21 11:29:40	996680	199979148	983324	200	72	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363682	SRX2659127	car2
SRR5363683	2017-03-21 11:40:07	2017-03-21 11:29:49	1089078	218680766	1076092	200	79	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363683	SRX2659128	car1
SRR5363684	2017-03-21 11:40:07	2017-03-21 11:29:57	1682993	337921519	1662784	200	118	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363684	SRX2659129	cef10
SRR5363685	2017-03-21 11:40:07	2017-03-21 11:29:46	1274849	255689623	1256747	200	92	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363685	SRX2659130	cef9
SRR5363686	2017-03-21 11:40:07	2017-03-21 11:29:22	1218188	244568636	1203299	200	87	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363686	SRX2659131	cef8
SRR5363687	2017-03-21 11:40:07	2017-03-21 11:30:06	2027741	406979584	2001785	200	142	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363687	SRX2659132	cef7
SRR5363688	2017-03-21 11:40:07	2017-03-21 11:29:38	998237	200918449	991068	201	72	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363688	SRX2659133	cef6
SRR5363689	2017-03-21 11:40:07	2017-03-21 11:29:26	518920	104507529	515814	201	41	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363689	SRX2659134	cef5
SRR5363690	2017-03-21 11:44:06	2017-03-21 11:33:47	11530820	2311357478	11354074	200	982	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363690	SRX2659135	cef4
SRR5363691	2017-03-21 11:40:07	2017-03-21 11:29:41	516125	103920037	512793	201	41	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363691	SRX2659136	cef3
SRR5363692	2017-03-21 11:40:07	2017-03-21 11:30:11	890572	179326220	884948	201	65	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363692	SRX2659137	cef2
SRR5363693	2017-03-21 11:40:07	2017-03-21 11:30:04	978135	196865238	971039	201	74	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363693	SRX2659138	cef1
SRR5363694	2017-03-21 11:40:07	2017-03-21 11:29:57	1959249	393031721	1932180	200	138	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363694	SRX2659139	imi2
SRR5363695	2017-03-21 11:40:07	2017-03-21 11:29:43	1074984	215595123	1059636	200	76	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363695	SRX2659140	imi1
SRR5363696	2017-03-21 11:41:07	2017-03-21 11:29:48	1288979	258545055	1270889	200	92	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363696	SRX2659141	dor10
SRR5363697	2017-03-21 11:42:06	2017-03-21 11:31:06	2908416	583478795	2868638	200	200	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363697	SRX2659142	dor9
SRR5363698	2017-03-21 11:49:07	2017-03-21 11:37:59	15442120	3097410993	15225523	200	1224	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363698	SRX2659143	dor8
SRR5363699	2017-03-21 11:40:07	2017-03-21 11:30:00	1718167	344971206	1697410	200	123	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363699	SRX2659144	dor7
SRR5363700	2017-03-21 11:41:07	2017-03-21 11:29:57	1739828	349655178	1722126	200	125	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363700	SRX2659145	dor6
SRR5363701	2017-03-21 11:45:06	2017-03-21 11:35:22	18584730	3732962863	18375556	200	1453	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363701	SRX2659146	dor5
SRR5363702	2017-03-21 11:44:06	2017-03-21 11:35:13	12158676	2438787680	11987886	200	981	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363702	SRX2659147	dor4
SRR5363703	2017-03-21 11:44:06	2017-03-21 11:34:44	11391713	2283748728	11219804	200	916	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363703	SRX2659148	dor3
SRR5363704	2017-03-21 11:42:06	2017-03-21 11:32:45	6155766	1236497552	6086854	200	513	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363704	SRX2659149	dor2
SRR5363705	2017-03-21 11:41:07	2017-03-21 11:30:25	1002355	201209957	989835	200	72	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363705	SRX2659150	dor1
SRR5363706	2017-03-21 11:41:07	2017-03-21 11:30:25	752409	151419028	746795	201	59	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363706	SRX2659151	cip10
SRR5363707	2017-03-21 11:44:06	2017-03-21 11:33:49	10594069	2127067244	10466132	200	870	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363707	SRX2659152	cip9
SRR5363708	2017-03-21 11:41:07	2017-03-21 11:30:31	1431059	287670501	1417182	201	105	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363708	SRX2659153	cip8
SRR5363709	2017-03-21 11:41:07	2017-03-21 11:30:41	1208297	242791534	1195595	200	88	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363709	SRX2659154	cip7
SRR5363710	2017-03-21 11:41:07	2017-03-21 11:30:35	1370364	275356971	1355960	200	100	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363710	SRX2659155	cip6
SRR5363711	2017-03-21 11:42:06	2017-03-21 11:31:24	1593545	320335049	1578109	201	116	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363711	SRX2659156	cip5
SRR5363712	2017-03-21 11:41:07	2017-03-21 11:31:00	1332160	267714312	1318490	200	99	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363712	SRX2659157	cip4
SRR5363713	2017-03-21 11:42:06	2017-03-21 11:31:02	1893119	379943269	1868718	200	134	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363713	SRX2659158	cip3
SRR5363714	2017-03-21 11:42:06	2017-03-21 11:31:01	1839276	369651139	1820660	200	129	assembly	https://raw.githubusercontent.com/jmchilton/galaxy-examples/master/sra_PRJNA355367/SRR5363714	SRX2659159	cip2
SRR5363715	2017-03-21 11:26:06	2017-03-21 10:59:33	712060	142833136	702138	200	51	assembly	https://sra-download.ncbi.nlm.nih.gov/traces/sra46/SRR/005238/SRR5363715	SRX2659160	cip1
</code></pre></div>        </div>
      </blockquote>

      <p><img src="../../images/rules/rules_example_6_1_paste.png" alt="screenshot" /></p>

      <p>The resulting table should look something like the following:
<img src="../../images/rules/rules_example_6_2_rules_landing.png" alt="screenshot" /></p>

      <p>Navigate to the end of the table and notice that column J is the URL target we are hoping to download for each file.</p>
    </li>
    <li>As in the previous exercises, please:
      <ul>
        <li>Set this <code class="highlighter-rouge">Column definition</code> for the URL target</li>
        <li>
          <p>Strip the header row</p>

          <blockquote class="solution">
            <h3 id="solution-solution"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
            <p>From <strong>Filter</strong> menu, select <code class="highlighter-rouge">First or Last N Rows</code></p>
            <ul>
              <li>Filter first Row</li>
            </ul>

            <p>From <strong>Rules</strong> menu, select  <code class="highlighter-rouge">Add / Modify Column Definitions</code></p>
            <ul>
              <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">URL</code>, Column <code class="highlighter-rouge">J</code>.
  <img src="../../images/rules/rules_example_6_3_end_of_table.png" alt="screenshot" /></li>
            </ul>
          </blockquote>
        </li>
      </ul>

      <p>For the analysis we wish to do, we want to group these files based on the type indicated in column <code class="highlighter-rouge">L</code> (LibraryName) shown below.
The source data though adds numbers to the library type to to generate the <code class="highlighter-rouge">LibraryName</code>, we need to strip those out to use the type
as an identifier for grouping the datasets. To do this, use the regex column adder rule again.</p>
    </li>
    <li>From <strong>Column</strong> menu, select <code class="highlighter-rouge">Using a Regular Expression</code>
      <ul>
        <li><em>“From Column”</em>: <code class="highlighter-rouge">L</code></li>
        <li>Select <code class="highlighter-rouge">Create column from regular expression groups</code></li>
        <li><em>“Regular Expression”</em>: <code class="highlighter-rouge">([^\d]+)\d+</code>.</li>
        <li><em>“Number of Groups”</em>: <code class="highlighter-rouge">1</code></li>
      </ul>

      <p>The result looks like:
<img src="../../images/rules/rules_example_6_4_regex.png" alt="screenshot" /></p>

      <blockquote class="comment">
        <h3 id="comment-regular-expression-explained-3"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Regular expression explained</h3>
        <p>In this regular expression, <code class="highlighter-rouge">\d</code> means any digit, so <code class="highlighter-rouge">[^...]</code> means match anything that is not inside the brackets.
So together <code class="highlighter-rouge">[^\d]+</code> means match one or more, non digits at the start of the column and the <code class="highlighter-rouge">()</code> around that means capture
them into a group. We’ve add <code class="highlighter-rouge">\d+</code> at the end of the expression but it isn’t grouped so we are effectively ignoring the
digits at the end as we had hoped.</p>
      </blockquote>

      <p>Now we have two columns we need to assign list identifiers for, the new column <code class="highlighter-rouge">M</code> for the first, outer identifier and the
first column <code class="highlighter-rouge">A</code> for the inner, second identifier.</p>
    </li>
    <li>From <strong>Rules</strong> menu, select <code class="highlighter-rouge">Add / Modify Column Definitions</code>
      <ul>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">List Identifier(s)</code>, Column <code class="highlighter-rouge">M</code></li>
        <li>Click on <code class="highlighter-rouge">... Assign Another Column</code></li>
        <li>
          <p>Select column <code class="highlighter-rouge">A</code></p>

          <blockquote class="comment">
            <h3 id="comment-re-ordering-columns"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Re-ordering columns</h3>
            <p>If you make a mistake in the order you select columns in you can simple use the up and down arrows to re-arrange the list</p>
          </blockquote>
        </li>
      </ul>

      <p>The result should look something like this:
<img src="../../images/rules/rules_example_6_5_multiple_identifiers_edit.png" alt="screenshot" /></p>
    </li>
    <li>
      <p>Click <code class="highlighter-rouge">Apply</code> to return to the rule preview screen and notice there are two column listed for the list identifier definition
  <img src="../../images/rules/rules_example_6_6_multiple_identifiers.png" alt="screenshot" /></p>
    </li>
    <li>Finalize your collection:
      <ul>
        <li><em>“Type”</em>: <code class="highlighter-rouge">txt</code></li>
        <li>Name your Collection</li>
        <li>Click <code class="highlighter-rouge">Upload</code></li>
      </ul>

      <p>Note: set <em>“Type”</em> to <code class="highlighter-rouge">sra</code> if you used real data from SRA instead of the table from exercise.
  <img src="../../images/rules/rules_example_6_7_named.png" alt="screenshot" /></p>
    </li>
  </ol>

</blockquote>

<h1 id="apply-rules-to-existing-collections">Apply Rules to Existing Collections</h1>

<p>To start this example, we will first upload a simple, flat collection of data. The data files we will use
will be the same as those used by the <a href="https://bioconductor.org/packages/devel/bioc/vignettes/DESeq2/inst/doc/DESeq2.html">DESeq2 Vignette</a>
from the <a href="https://bioconductor.org/packages/release/data/experiment/html/pasilla.html">Pasilla Bioconductor Package</a>.</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-applying-rules-to-existing-collections"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Applying Rules to Existing Collections</h3>

  <ol>
    <li>Open the Rule Builder
      <ul>
        <li><em>“Upload data as”</em>: <code class="highlighter-rouge">Collection(s)</code></li>
        <li><em>“Load tabular data from”</em>: <code class="highlighter-rouge">Pasted Table</code></li>
        <li>Paste the following table:</li>
      </ul>

      <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://raw.githubusercontent.com/jmchilton/galaxy/apply_rules_tutorials/test-data/rules/treated1fb.txt treated_single_1
https://raw.githubusercontent.com/jmchilton/galaxy/apply_rules_tutorials/test-data/rules/treated2fb.txt treated_paired_2
https://raw.githubusercontent.com/jmchilton/galaxy/apply_rules_tutorials/test-data/rules/treated3fb.txt treated_paired_3
https://raw.githubusercontent.com/jmchilton/galaxy/apply_rules_tutorials/test-data/rules/untreated1fb.txt untreated_single_4
https://raw.githubusercontent.com/jmchilton/galaxy/apply_rules_tutorials/test-data/rules/untreated2fb.txt untreated_single_5
https://raw.githubusercontent.com/jmchilton/galaxy/apply_rules_tutorials/test-data/rules/untreated3fb.txt untreated_paired_6
https://raw.githubusercontent.com/jmchilton/galaxy/apply_rules_tutorials/test-data/rules/untreated4fb.txt untreated_paired_7
</code></pre></div>      </div>

      <p>Next, we set up the column types:</p>
    </li>
    <li>From <strong>Rules</strong> menu, select  <code class="highlighter-rouge">Add / Modify Column Definitions</code>
      <ul>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">URL</code>, column <code class="highlighter-rouge">A</code></li>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">List Identifier(s)</code>, column <code class="highlighter-rouge">B</code>
<img src="../../images/rules/rules_apply_rules_example_4_2_input_rules.png" alt="screenshot" /></li>
      </ul>
    </li>
    <li>Finalize the collection:
      <ul>
        <li><em>“Type”</em>: <code class="highlighter-rouge">txt</code></li>
        <li>Give the collection a name.</li>
        <li>Click <code class="highlighter-rouge">Build</code>
<img src="../../images/rules/rules_apply_rules_example_4_4_input_list.png" alt="screenshot" /></li>
      </ul>

      <p>The first thing we will do to this new collection is add some levels or depth to its structure.
Lets assume we want to group it into “treated” and “untreated” lists and “paired” and “single”
sublists below that. We can do this with the <code class="highlighter-rouge">Apply Rules</code> collection operation tool, which will
likely be under the <code class="highlighter-rouge">Collection Operations</code> tool menu in your Galaxy interface.</p>
    </li>
    <li>
      <p>Open the <strong>Apply Rule to Collection</strong> tool</p>

      <p>The very simple interface should look something like this:
<img src="../../images/rules/rules_apply_rules_example_4_5_apply_rules_landing.png" alt="screenshot" /></p>

      <p>This interface simply lets one pick a collection to operate on and then launch the rule builder
window to work to describe and preview manipulating the metadata of that collection.</p>
    </li>
    <li><strong>Apply Rule to Collection</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><em>“Input Collection”</em>: the collection we just uploaded</li>
        <li>Click the <code class="highlighter-rouge">Edit</code> button
<img src="../../images/rules/rules_apply_rules_example_4_6_apply_rules_init_flat.png" alt="screenshot" /></li>
      </ul>

      <p>When a flat collection is used with this tool, the rule builder will initialize a default rule to pull
the list identifier out for each item of the collection as shown above. Next we will use regular expressions
to build two new columns, these columns will group the datasets into “treated” and “untreated” sublists and
then “single” and “paired” sublists of that. This rule is found under the <code class="highlighter-rouge">Column</code> menu.</p>

      <p>We’ll transform column A into some more useful columns</p>
    </li>
    <li>From <strong>Column</strong>, select <code class="highlighter-rouge">Using a Regular Expression</code>
      <ul>
        <li><em>“Column”</em>: <code class="highlighter-rouge">A</code></li>
        <li>Select <code class="highlighter-rouge">Create columns matching expression groups</code></li>
        <li><em>“Regular Expression”</em>: <code class="highlighter-rouge">(.*)_(.*)_.*</code></li>
        <li><em>“Number of Groups”</em>: <code class="highlighter-rouge">2</code></li>
      </ul>

      <blockquote class="comment">
        <h3 id="comment-regular-expression-explained-4"><i class="fa fa-commenting-o" aria-hidden="true"></i><span class="visually-hidden">comment</span> Regular expression explained</h3>
        <p>Here <code class="highlighter-rouge">.*</code> means match any number of any character - so basically match anything.
 The parentheses around <code class="highlighter-rouge">.*</code> means form a “group” from whatever is matched.
 The <code class="highlighter-rouge">_</code> describes the literal <code class="highlighter-rouge">_</code> values in the identifier we are matching. The result is that
everything before the first <code class="highlighter-rouge">_</code> will be matched as the first group and everything between the <code class="highlighter-rouge">_</code>
characters will be matched as the second group. Click to apply this rule and two new columns should be created.</p>

        <p>We have defined two matching groups (the <code class="highlighter-rouge">(.*)</code> in the regex), so the number of groups is set to <code class="highlighter-rouge">2</code></p>
      </blockquote>
    </li>
    <li>From  <strong>Rules</strong>, select <code class="highlighter-rouge">Add / Modify Column Definitions</code>
      <ul>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">List Identifier(s)</code>, Column <code class="highlighter-rouge">B</code></li>
        <li><code class="highlighter-rouge">Assign another column</code>, column <code class="highlighter-rouge">C</code></li>
        <li><code class="highlighter-rouge">Assign another column</code>, column <code class="highlighter-rouge">A</code></li>
        <li>Click <code class="highlighter-rouge">Save</code></li>
      </ul>

      <p><img src="../../images/rules/rules_apply_rules_example_4_7_apply_rules_add_depth.png" alt="screenshot" /></p>

      <p>The resulting collection should have two new levels of depth for “untreated” vs “treated” and “paired” vs “single” as shown below:
<img src="../../images/rules/rules_apply_rules_example_4_8_nested.png" alt="screenshot" /></p>

      <p>Placing the “single” and “paired” sublists inside the “treated” and “untreated” lists was a bit arbitrary and depending on the
workflow these may need to be inverted at different parts of an analysis. The <strong>Apply Rules</strong> tool can be used to invert these levels
if that is needed.</p>
    </li>
    <li><strong>Apply Rule to Collection</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><em>“Input Collection”</em>: the new nested list we created in the previous step</li>
        <li>Click “Edit”.</li>
      </ul>

      <p><img src="../../images/rules/rules_apply_rules_example_4_9_apply_rules_init_nested.png" alt="screenshot" /></p>

      <p>Notice when loading a nested collection into the rule builder, there is a column for each layer of the list for each element.
One can pretty easily invert the outer two layers of the list by simply assigning the list identifiers in a new order. So select to assign “List Identifiers” and this time assign them to columns “B”, “A”, and “C” - in that order.</p>
    </li>
    <li>From <strong>Rules</strong>, select <code class="highlighter-rouge">Add / Modify Column Definitions</code>
      <ul>
        <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">List Identifier(s)</code>, Column <code class="highlighter-rouge">B</code></li>
        <li><code class="highlighter-rouge">Assign another column</code>, Column <code class="highlighter-rouge">A</code></li>
        <li><code class="highlighter-rouge">Assign another column</code>, Column <code class="highlighter-rouge">C</code></li>
        <li>Click <code class="highlighter-rouge">Save</code></li>
      </ul>

      <p><img src="../../images/rules/rules_apply_rules_example_4_10_apply_rules_inverted.png" alt="screenshot" /></p>

      <p>The resulting collection should be inverted.</p>

      <p><img src="../../images/rules/rules_apply_rules_example_4_11_inverted.png" alt="screenshot" /></p>

      <p>In addition to structural re-organizations of a collection, the Apply Rules tool can be used to
filter elements out of the collection.</p>
    </li>
    <li><strong>Apply Rule to Collection</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li><em>“Input Collection”</em>: the original flat list created</li>
        <li>Click <code class="highlighter-rouge">Edit</code></li>
        <li>From <strong>Filter</strong> menu, select <code class="highlighter-rouge">From a regular expression</code>
          <ul>
            <li><em>“From Column”</em>: <code class="highlighter-rouge">A</code></li>
            <li><em>“Regular Expression”</em>: <code class="highlighter-rouge">.*_single_.*</code></li>
          </ul>
        </li>
        <li>From <strong>Rules</strong> menu, select <code class="highlighter-rouge">Add / Modify Column Definitions</code>
          <ul>
            <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">List Identifier(s)</code>, Column <code class="highlighter-rouge">A</code></li>
          </ul>
        </li>
      </ul>

      <p><img src="../../images/rules/rules_apply_rules_example_4_12_apply_rules_filter.png" alt="screenshot" /></p>

      <p>The resulting collection should be a filtered version of the original list.</p>

      <p><img src="../../images/rules/rules_apply_rules_example_4_13_filtered.png" alt="screenshot" /></p>

      <p>Structural re-organizations of collections can also be combined with filtering. To demonstrate this, reopen the original flat list created for this example again in the rule builder of the Apply Rules tool. Use the same regular expression as last time to filter the result but also add a column for “treated” and “untreated” list identifiers.</p>
    </li>
    <li><strong>Apply Rule to Collection</strong> <i class="fa fa-wrench" aria-hidden="true"></i><span class="visually-hidden">tool</span> with the following parameters:
      <ul>
        <li>From <strong>Filter</strong> menu, select <code class="highlighter-rouge">Using a Regular Expression</code>
          <ul>
            <li><em>“From Column”</em>: <code class="highlighter-rouge">A</code></li>
            <li><em>“Regular Expression”</em>: <code class="highlighter-rouge">.*_single_.*</code></li>
          </ul>
        </li>
        <li>From <strong>Column</strong> menu, select <code class="highlighter-rouge">Using a Regular Expression</code>
          <ul>
            <li><em>“From Column”</em>: <code class="highlighter-rouge">A</code></li>
            <li>Select <code class="highlighter-rouge">Create column from regular expression groups</code></li>
            <li><em>“Regular Expression”</em>:  <code class="highlighter-rouge">(.*)_single_.*</code></li>
            <li><em>“Number of Groups”</em>: <code class="highlighter-rouge">1</code></li>
          </ul>
        </li>
        <li>From <strong>Rules</strong> menu, select  <code class="highlighter-rouge">Add / Modify Column Definitions</code>
          <ul>
            <li><code class="highlighter-rouge">Add Definition</code>, <code class="highlighter-rouge">List Identifier(s)</code>. Column <code class="highlighter-rouge">B</code></li>
            <li><code class="highlighter-rouge">Assign another column</code>, Column <code class="highlighter-rouge">A</code></li>
          </ul>
        </li>
      </ul>

      <p><img src="../../images/rules/rules_apply_rules_example_4_14_apply_rules_filtered_and_nested.png" alt="screenshot" /></p>

      <p>The resulting collection should be a filtered to only include the “single” data and broken into “treated” and “untreated” sublists.</p>

      <p><img src="../../images/rules/rules_apply_rules_example_4_15_filtered_and_nested.png" alt="screenshot" /></p>
    </li>
  </ol>
</blockquote>



                    

                    

                    

                </div>
            </div>
        </div>

        <h3><i class="fa fa-thumbs-up" aria-hidden="true"></i><span class="visually-hidden">congratulations</span> Congratulations on successfully completing this tutorial!</h3>

        

        

        <hr>
        <br>

        <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Collections: Rule Based Uploader (Data Manipulation)">Loading...
        </iframe>

        <blockquote class="feedback">
            <h3><i class="fa fa-comments-o" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Give us even more feedback on this content!</h3>
            <p>To give us more detailed feedback about these materials, please take a moment to fill in the extended <a href="https://docs.google.com/forms/d/e/1FAIpQLSc_GLZRpxZGAL9tN6DA1bE6WkNhmQdXT7B16TpOb-X4YwKUsQ/viewform?entry.1548889262=Collections: Rule Based Uploader (Data Manipulation)">Feedback Form</a>.</p>
        </blockquote>
    </section>
</div>


<footer>
    <div class="container">
        <p>
            This material is the result of a collaborative work. Thanks to the
            <a href="https://wiki.galaxyproject.org/Teach/GTN">Galaxy Training Network</a>
            and all the <a href="/training-material/hall-of-fame">contributors</a> (John Chilton, Helena Rasche)!
        </p>
        <p>
            Found a typo? Something is wrong in this tutorial? Edit it on
            <a href="https://github.com/galaxyproject/training-material/tree/master/topics/galaxy-data-manipulation/tutorials/upload-rules/tutorial.md">GitHub</a>.
        </p>
    </div>
</footer>

    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
</html>

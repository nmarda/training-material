<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Galaxy Monitoring with gxadmin</title>
        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-45719423-18' , 'auto');
            ga('send', 'pageview');
        </script>
        
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap.min.css?v=3">
        <link rel="stylesheet" href="/training-material/assets/css/bootstrap-toc.min.css">
        <link rel="stylesheet" href="/training-material/assets/css/main.css?v=2">
        <link rel="stylesheet" href="/training-material/assets/css/font-awesome.css">
        <link rel="stylesheet" href="/training-material/assets/css/academicons.css">
        <link rel="stylesheet" href="/training-material/assets/css/syntax_highlighting.css">
        <link rel="shortcut icon" href="/training-material/favicon.ico" type="image/x-icon" />

        
        
        
        
        
        <meta name="description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:title" content="Galaxy Training: Galaxy Monitoring with gxadmin" />
        <meta property="og:description" content="Resources related to configuration and maintenance of Gal..." />
        <meta property="og:image" content="/training-material/assets/images/GTNLogo1000.png" />
    </head>
    <body data-spy="scroll" data-target="#toc">
        











<header>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/training-material/">
                <img src="/training-material/assets/images/GTN-60px.png" height="30" alt="Galaxy Training Network logo">
                Galaxy Training!
            </a>

            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#top-navbar" aria-controls="top-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/training-material/topics/admin" title="Go back to list of tutorials">
                            <i class="fa fa-folder-o" aria-hidden="true"></i><span class="visually-hidden">topic</span> Galaxy Server administration
                        </a>
                    </li>

                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="EN">
                            EN
                        </a>
                        <div class="dropdown-menu">
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=fr&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fgxadmin%2Ftutorial.html&edit-text=&act=url" title="">
                                FR
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ja&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fgxadmin%2Ftutorial.html&edit-text=&act=url" title="">
                                JA
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=es&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fgxadmin%2Ftutorial.html&edit-text=&act=url" title="">
                                ES
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=pt&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fgxadmin%2Ftutorial.html&edit-text=&act=url" title="">
                                PT
                            </a>
                            
                            <a class="dropdown-item" href="https://translate.google.com/translate?hl=jp&sl=en&tl=ar&u=https%3A%2F%2Ftraining.galaxyproject.org%2Ftopics%2Fadmin%2Ftutorials%2Fgxadmin%2Ftutorial.html&edit-text=&act=url" title="">
                                AR
                            </a>
                            
                        </div>
                    </li>

                    <li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" title="Help">
        <i class="fa fa-life-ring" aria-hidden="true"></i><span class="visually-hidden">help</span> Help
    </a>
    <div class="dropdown-menu dropdown-menu-right">
        <form method="get" action="https://tess.elixir-europe.org/materials">
            <input type="text" id="search" name="q" value="" style="margin-left: 0.5em;/*! border-radius: 0px; */">
            <input type="hidden" value="Galaxy Training" name="content_provider">
            <input type="submit" value="Search on TeSS" style="width: 92%;border-radius: 0px;margin: 0.5em;background: #f47d20;border: 0px;padding: 0.25em;" class="">
        </form>

        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/training-material/faq" title="Check our FAQ">
            FAQ
        </a>
        <a class="dropdown-item" href="https://gitter.im/Galaxy-Training-Network/Lobby" title="Chat on Gitter">
            Chat on Gitter
        </a>
        <a class="dropdown-item" href="https://help.galaxyproject.org/" title="Discuss on Galaxy Help">
            Discuss on Galaxy Help
        </a>
    </div>
</li>


                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/galaxyproject/training-material/edit/master/topics/admin/tutorials/gxadmin/tutorial.md">
                            <i class="fa fa-github" aria-hidden="true"></i><span class="visually-hidden">github</span> Edit
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>

<div class="container main-content">
    <script type="application/ld+json">
        


{
  "@context": "http://schema.org",
  "@type": "Course",
  "accessMode": [
    "textual",
    "visual"
  ],
  "accessModeSufficient": [
    "textual",
    "visual"
  ],
  "accessibilityControl": [
    "fullKeyboardControl",
    "fullMouseControl"
  ],
  "accessibilityFeature": [
    "alternativeText",
    "tableOfContents"
  ],
  "accessibilitySummary": "Short descriptions are present but long descriptions will be needed for non-visual users",
  "audience": {
    "@type": "EducationalAudience",
    "educationalRole": "students"
  },
  "citation": {
    "@type": "CreativeWork",
    "name": "Community-Driven Data Analysis Training for Biology",
    "url": "https://doi.org/10.1016/j.cels.2018.05.012"
  },
  "copyrightHolder": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "discussionUrl": "https://gitter.im/Galaxy-Training-Network/Lobby",
  "headline": "Galaxy Monitoring with gxadmin",
  "inLanguage": {
    "@type": "Language",
    "name": "English",
    "alternateName": "en"
  },
  "interactivityType": "mixed",
  "isAccessibleForFree": true,
  "license": "/blob//LICENSE.md",
  "producer": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "provider": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "sourceOrganization": {
    "@type": "Organization",
    "email": "galaxytrainingnetwork@gmail.com",
    "name": "Galaxy Training Network",
    "url": "https://galaxyproject.org/teach/gtn/"
  },
  "courseCode": "admin / gxadmin / hands-on",
  "learningResourceType": "hands-on tutorial",
  "name": "Hands-on for 'Galaxy Monitoring with gxadmin' tutorial",
  "isPartOf": {
    "@type": "Course",
    "name": "Galaxy Monitoring with gxadmin",
    "description": "Galaxy Monitoring with gxadmin",
    "learningResourceType": "tutorial",
    "interactivityType": "expositive",
    "provider": {
      "@type": "Organization",
      "email": "galaxytrainingnetwork@gmail.com",
      "name": "Galaxy Training Network",
      "url": "https://galaxyproject.org/teach/gtn/"
    }
  },
  "url": "https://galaxyproject.github.io//training-material/topics/admin/tutorials/gxadmin/tutorial.html",
  "timeRequired": "PT30M",
  "keywords": "ansible",
  "description": "Galaxy Monitoring with gxadmin\\nThe questions this  addresses are:\n - What is gxadmin\n - What can it do?\n - How to write a query?\n\n\\nThe objectives are:\n - Learn gxadmin basics\n - See some queries and learn how they help debug production issues\n\n",
  "hasPart": [

  ],
  "mentions": [
    {
      "@type": "Thing",
      "url": "",
      "name": "Training data for Galaxy Monitoring with gxadmin tutorial"
    }
  ],
  "author": [
    {
      "@type": "Person",
      "name": "Helena Rasche"
    }
  ],
  "contributor": [
    {
      "@type": "Person",
      "name": "Helena Rasche"
    }
  ],
  "about": [
    {
      "@type": "CreativeWork",
      "name": "Galaxy Server administration",
      "description": "Resources related to configuration and maintenance of Galaxy servers",
      "url": "https://galaxyproject.github.io//training-material/topics/admin/"
    }
  ]
}
    </script>

    <section class="tutorial">
        <h1 data-toc-skip>Galaxy Monitoring with gxadmin</h1>
        <div class="contributors-line">By: 

<a href="/training-material/hall-of-fame#erasche" class="contributor-badge"><img src="https://avatars.githubusercontent.com/erasche" alt="Helena Rasche">Helena Rasche</a>

</div>
        <blockquote class="overview">
            <h3>Overview</h3>
            <strong><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Questions</strong>
            <ul>
            
            <li>What is gxadmin</li>
            
            <li>What can it do?</li>
            
            <li>How to write a query?</li>
            
            </ul>

            <strong><i class="fa fa-bullseye" aria-hidden="true"></i><span class="visually-hidden">objectives</span> Objectives</strong>
            <ul>
            
            <li>Learn gxadmin basics</li>
            
            <li>See some queries and learn how they help debug production issues</li>
            
            </ul>

            

            
            <p><strong><i class="fa fa-hourglass-end" aria-hidden="true"></i><span class="visually-hidden">time</span> Time estimation:</strong> 30 minutes</p>
            

            



            <div>
                <div><strong><i class="fa fa-external-link" aria-hidden="true"></i> Supporting Materials</strong></div>
                <div id="supporting_materials">
                    <ul>
                        <li>
                            <div>
                    
                    <div>
                        <a class="topic-icon" href="/training-material/topics/admin/tutorials/gxadmin/slides.html" title="Slides for this tutorial">
                            <i class="fa fa-slideshare" aria-hidden="true"></i><span class="visually-hidden">slides</span> Slides
                        </a>
                    </div>
                    

                    

                    
                    


                    
                    
                    <div>
                        

    <a href="#" class="btn btn-default dropdown-toggle topic-icon" data-toggle="dropdown" aria-expanded="false" title="Where to run the tutorial">
        <i class="fa fa-cog" aria-hidden="true"></i><span class="visually-hidden">instances</span> Galaxies
    </a>
    <ul class="dropdown-menu">
    
        <li>
            <a class="dropdown-item" href="https://github.com/galaxyproject/training-material/tree/master/topics/admin/docker" title="Docker image for this tutorial">
                <i class="fa fa-ship" aria-hidden="true"></i><span class="visually-hidden">docker_image</span> Docker image
            </a>
        </li>
    
    
    </ul>



                    </div>
                    
                    
                            </div>
                        </li>
                    </ul>
                </div>

            </div>

        </blockquote>

        <div class="container">
            <div class="row">
                <!-- sidebar, which will move to the top on a small screen -->
                <div class="col-sm-2">
                    <nav id="toc" data-toggle="toc" class="sticky-top"></nav>
                </div>
                <div class="col-sm-10">
                    <h1 class="no_toc" id="overview">Overview</h1>

<p>We will just briefly cover the features available in <code class="highlighter-rouge">gxadmin</code>, there are lots of queries that may or may not be useful for your Galaxy instance and you will have to read the documentation before using them.</p>

<p>It started life as a small shell script that Helena wrote because she couldn’t remember what <a href="https://github.com/galaxyproject/gravity">Gravity</a> was called or where it could be found. Some of the functions needed for things like swapping zerglings are still included in gxadmin but are highly specific to UseGalaxy.eu and not generally useful.</p>

<p>Since then it became the home for “all of the SQL queries we [galaxy admins] run regularly.” @erasche and @natefoo often shared SQL queries with each other in private chats, but this wasn’t helpful to the admin community at large, so they decided to put them all in <code class="highlighter-rouge">gxadmin</code> and make it as easy to install as possible. We are continually trying to make this tool more generic and generally useful, if you notice something that’s missing or broken, or have a new query you want to run, just <a href="https://github.com/usegalaxy-eu/gxadmin/issues/new">let us know</a>.</p>

<blockquote class="agenda">
  <h3 id="agenda">Agenda</h3>

<ol id="markdown-toc">
  <li><a href="#installation-with-ansible" id="markdown-toc-installation-with-ansible">Installation with Ansible</a></li>
  <li><a href="#configuration" id="markdown-toc-configuration">Configuration</a></li>
  <li><a href="#overview-1" id="markdown-toc-overview-1">Overview</a></li>
  <li><a href="#admin-favourite-queries" id="markdown-toc-admin-favourite-queries">Admin Favourite Queries</a></li>
  <li><a href="#gxadmin-for-monitoring" id="markdown-toc-gxadmin-for-monitoring"><code class="highlighter-rouge">gxadmin</code> for Monitoring</a></li>
  <li><a href="#implementing-a-query" id="markdown-toc-implementing-a-query">Implementing a Query</a>    <ol>
      <li><a href="#a-basic-function" id="markdown-toc-a-basic-function">A basic function</a></li>
      <li><a href="#adding-help" id="markdown-toc-adding-help">Adding help</a></li>
      <li><a href="#adding-a-query" id="markdown-toc-adding-a-query">Adding a query</a></li>
    </ol>
  </li>
  <li><a href="#summary" id="markdown-toc-summary">Summary</a></li>
</ol>

</blockquote>

<h2 id="installation-with-ansible">Installation with Ansible</h2>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-installing-gxadmin-with-ansible"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Installing gxadmin with Ansible</h3>

  <ol>
    <li>
      <p>Edit your <code class="highlighter-rouge">requirements.yml</code> and add the following:</p>

      <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">src</span><span class="pi">:</span> <span class="s">https://github.com/usegalaxy-eu/ansible-gxadmin</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">usegalaxy-eu.gxadmin</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Install the role with <code class="highlighter-rouge">ansible-galaxy install -p roles -r requirements.yml</code></p>
    </li>
    <li>
      <p>Add the role to your playbook, it should run as root</p>
    </li>
    <li>
      <p>Run the playbook</p>
    </li>
  </ol>

</blockquote>

<h2 id="configuration">Configuration</h2>

<p>If <code class="highlighter-rouge">psql</code> runs without any additional arguments, and permits you to access your galaxy database then you do not need to do any more configuration for gxadmin.
Otherwise, you may need to set some of the <a href="https://github.com/usegalaxy-eu/gxadmin#query-setup">PostgreSQL environment variables</a></p>

<h2 id="overview-1">Overview</h2>

<p><code class="highlighter-rouge">gxadmin</code> has several categories of commands, each with different focuses. This is not a technically meaningful separation, it is just done to make the interface easier for end users.</p>

<table>
  <thead>
    <tr>
      <th>Category</th>
      <th>Keyword</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Configuration</td>
      <td><code class="highlighter-rouge">config</code></td>
      <td>Commands relating to galaxy’s configuration files like XML validation.</td>
    </tr>
    <tr>
      <td>Filters</td>
      <td><code class="highlighter-rouge">filter</code></td>
      <td>Transforming streams of text.</td>
    </tr>
    <tr>
      <td>Galaxy Admin</td>
      <td><code class="highlighter-rouge">galaxy</code></td>
      <td>Miscellaneous galaxy related commands like a cleanup wrapper.</td>
    </tr>
    <tr>
      <td>uWSGI</td>
      <td><code class="highlighter-rouge">uwsgi</code></td>
      <td>If you’re using <a href="https://github.com/usegalaxy-eu/ansible-galaxy-systemd/">SystemD for Galaxy</a> and a handler/zergling setup, then this lets you manage your handlers and zerglings.</td>
    </tr>
    <tr>
      <td>DB Queries</td>
      <td><code class="highlighter-rouge">{csv,tsv,i,}query</code></td>
      <td>Queries against the database which return tabular output.</td>
    </tr>
    <tr>
      <td>Report</td>
      <td><code class="highlighter-rouge">report</code></td>
      <td>Queries which return more complex and structured markdown reports.</td>
    </tr>
    <tr>
      <td>Mutations</td>
      <td><code class="highlighter-rouge">mutate</code></td>
      <td>These are like queries, except they mutate the database. All other queries are read-only.</td>
    </tr>
    <tr>
      <td>Meta</td>
      <td><code class="highlighter-rouge">meta</code></td>
      <td>More miscellaneous commands, and a built-in updating function.</td>
    </tr>
  </tbody>
</table>

<h2 id="admin-favourite-queries">Admin Favourite Queries</h2>

<p><strong>@slugger70’s favourite</strong>: <code class="highlighter-rouge">gxadmin query old-histories</code>. He contributed this function to find old histories, as their instance has a 90 day limit on histories, anything older than that might be automatically removed. This helps their group identify any histories that can be purged in order to save space. Running this on UseGalaxy.eu, we have some truly ancient histories, and maybe could benefit from a similar policy.</p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>update-time</th>
      <th>user-id</th>
      <th>email</th>
      <th>name</th>
      <th>published</th>
      <th>deleted</th>
      <th>purged</th>
      <th>hid-counter</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>361</td>
      <td>2013-02-24 16:27:29.197572</td>
      <td>xxx</td>
      <td>xxxx</td>
      <td>Unnamed history</td>
      <td>f</td>
      <td>f</td>
      <td>f</td>
      <td>6</td>
    </tr>
    <tr>
      <td>362</td>
      <td>2013-02-24 15:31:05.804747</td>
      <td>xxx</td>
      <td>xxxx</td>
      <td>Unnamed history</td>
      <td>f</td>
      <td>f</td>
      <td>f</td>
      <td>1</td>
    </tr>
    <tr>
      <td>347</td>
      <td>2013-02-22 15:59:12.044169</td>
      <td>xxx</td>
      <td>xxxx</td>
      <td>Unnamed history</td>
      <td>f</td>
      <td>f</td>
      <td>f</td>
      <td>19</td>
    </tr>
    <tr>
      <td>324</td>
      <td>2013-02-22 15:57:54.500637</td>
      <td>xxx</td>
      <td>xxxx</td>
      <td>Exercise 5</td>
      <td>f</td>
      <td>f</td>
      <td>f</td>
      <td>64</td>
    </tr>
    <tr>
      <td>315</td>
      <td>2013-02-22 15:50:51.398894</td>
      <td>xxx</td>
      <td>xxxx</td>
      <td>day5 practical</td>
      <td>f</td>
      <td>f</td>
      <td>f</td>
      <td>90</td>
    </tr>
    <tr>
      <td>314</td>
      <td>2013-02-22 15:45:47.75967</td>
      <td>xxx</td>
      <td>xxxx</td>
      <td>5. Tag Galaxy-Kurs</td>
      <td>f</td>
      <td>f</td>
      <td>f</td>
      <td>78</td>
    </tr>
  </tbody>
</table>

<p><strong>@natefoo’s favourite</strong>: <code class="highlighter-rouge">gxadmin query job-inputs</code>. He contributed this function which helps him debug jobs which are not running and should be. The query can</p>

<table>
  <thead>
    <tr>
      <th>hda-id</th>
      <th>hda-state</th>
      <th>hda-deleted</th>
      <th>hda-purged</th>
      <th>d-id</th>
      <th>d-state</th>
      <th>d-deleted</th>
      <th>d-purged</th>
      <th>object-store-id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>8638197</td>
      <td> </td>
      <td>f</td>
      <td>f</td>
      <td>8246854</td>
      <td>running</td>
      <td>f</td>
      <td>f</td>
      <td>files9</td>
    </tr>
    <tr>
      <td>8638195</td>
      <td> </td>
      <td>f</td>
      <td>f</td>
      <td>8246852</td>
      <td>running</td>
      <td>f</td>
      <td>f</td>
      <td>files9</td>
    </tr>
    <tr>
      <td>8638195</td>
      <td> </td>
      <td>f</td>
      <td>f</td>
      <td>8246852</td>
      <td>running</td>
      <td>f</td>
      <td>f</td>
      <td>files9</td>
    </tr>
  </tbody>
</table>

<p><strong>@bgruening’s favourite</strong>: <code class="highlighter-rouge">gxamdin query latest-users</code> let’s us see who has recently joined our server. We sometimes notice that people are running a training on our infrastructure and they haven’t registered for <a href="https://galaxyproject.eu/tiaas">training infrastructure as a service</a> which helps us coordinate infrastructure for them so they don’t have bad experiences.</p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>create_time</th>
      <th>disk_usage</th>
      <th>username</th>
      <th>email</th>
      <th>groups</th>
      <th>active</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>3937</td>
      <td>2019-01-27 14:11:12.636399</td>
      <td>291 MB</td>
      <td>xxxx</td>
      <td>xxxx</td>
      <td> </td>
      <td>t</td>
    </tr>
    <tr>
      <td>3936</td>
      <td>2019-01-27 10:41:07.76126</td>
      <td>1416 MB</td>
      <td>xxxx</td>
      <td>xxxx</td>
      <td> </td>
      <td>t</td>
    </tr>
    <tr>
      <td>3935</td>
      <td>2019-01-27 10:13:01.499094</td>
      <td>2072 kB</td>
      <td>xxxx</td>
      <td>xxxx</td>
      <td> </td>
      <td>t</td>
    </tr>
    <tr>
      <td>3934</td>
      <td>2019-01-27 10:06:40.973938</td>
      <td>0 bytes</td>
      <td>xxxx</td>
      <td>xxxx</td>
      <td> </td>
      <td>f</td>
    </tr>
    <tr>
      <td>3933</td>
      <td>2019-01-27 10:01:22.562782</td>
      <td> </td>
      <td>xxxx</td>
      <td>xxxx</td>
      <td> </td>
      <td>f</td>
    </tr>
  </tbody>
</table>

<p><strong>@erasche’s favourite</strong> <code class="highlighter-rouge">gxadmin report job-info</code>. This command gives more information than you probably need on the execution of a specific job, formatted as markdown for easy sharing with fellow administrators.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Galaxy Job 5132146

Property      | Value
------------- | -----
         Tool | toolshed.g2.bx.psu.edu/repos/bgruening/canu/canu/1.7
        State | running
      Handler | handler_main_2
      Created | 2019-04-20 11:04:40.854975+02 (3 days 05:49:30.451719 ago)
Job Runner/ID | condor / 568537
        Owner | e08d6c893f5

## Destination Parameters

Key                     |   Value
---                     |   ---
description             |   `canu`
priority                |   `-128`
request_cpus            |   `20`
request_memory          |   `64G`
requirements            |   `GalaxyGroup == "compute"`
tmp_dir                 |   `True`

## Dependencies

Name   |   Version   |   Dependency Type   |   Cacheable   |   Exact   |   Environment Path                          |   Model Class
---    |   ---       |   ---               |   ---         |   ---     |   ---                                       |   ---
canu   |   1.7       |   conda             |   false       |   true    |   /usr/local/tools/_conda/envs/__canu@1.7   |   MergedCondaDependency

## Tool Parameters

Name                 |   Settings
---------            |   ------------------------------------
minOverlapLength     |   500
chromInfo            |   /opt/galaxy/tool-data/shared/ucsc/chrom/?.len
stage                |   all
contigFilter         |   {lowCovDepth: 5, lowCovSpan: 0.5, minLength: 0, minReads: 2, singleReadSpan: 1.0}
s                    |   null
mode                 |   -nanopore-raw
dbkey                |   ?
genomeSize           |   300000
corOutCoverage       |   40
rawErrorRate         |
minReadLength        |   1000
correctedErrorRate   |

## Inputs

Job ID    |   Name                |   Extension     |   hda-id    |   hda-state   |   hda-deleted   |   hda-purged   |   ds-id     |   ds-state   |   ds-deleted   |   ds-purged   |   Size
----      |   ----                |   ----          |   ----      |   ----        |   ----          |   ----         |   ----      |   ----       |   ----         |   ----        |   ----
4975404   |   Osur_record.fastq   |   fastqsanger   |   9517188   |               |   t             |   f            |   9015329   |   ok         |   f            |   f           |   3272 MB
4975404   |   Osur_record.fastq   |   fastqsanger   |   9517188   |               |   t             |   f            |   9015329   |   ok         |   f            |   f           |   3272 MB

## Outputs

Name                                          |   Extension   |   hda-id    |   hda-state   |   hda-deleted   |   hda-purged   |   ds-id     |   ds-state   |   ds-deleted   |   ds-purged   |   Size
----                                          |   ----        |   ----      |   ----        |   ----          |   ----         |   ----      |   ----       |   ----         |   ----        |   ----
Canu assembler on data 41 (trimmed reads)     |   fasta.gz    |   9520369   |               |   f             |   f            |   9018510   |   running    |   f            |   f           |
Canu assembler on data 41 (corrected reads)   |   fasta.gz    |   9520368   |               |   f             |   f            |   9018509   |   running    |   f            |   f           |
Canu assembler on data 41 (unitigs)           |   fasta       |   9520367   |               |   f             |   f            |   9018508   |   running    |   f            |   f           |
Canu assembler on data 41 (unassembled)       |   fasta       |   9520366   |               |   f             |   f            |   9018507   |   running    |   f            |   f           |
Canu assembler on data 41 (contigs)           |   fasta       |   9520365   |               |   f             |   f            |   9018506   |   running    |   f            |   f           |
</code></pre></div></div>

<h1 id="gxadmin-for-monitoring"><code class="highlighter-rouge">gxadmin</code> for Monitoring</h1>

<p><code class="highlighter-rouge">gxadmin</code> already supported <code class="highlighter-rouge">query</code>, <code class="highlighter-rouge">csvquery</code>, and <code class="highlighter-rouge">tsvquery</code> for requesting data from the Galaxy database in tables, CSV, or TSV formats, but we recently implemented <code class="highlighter-rouge">influx</code> queries which output data in a format that <a href="https://github.com/influxdata/telegraf">Telegraf</a> can consume.</p>

<p>So running <code class="highlighter-rouge">gxadmin query queue-overview</code> normally shows something like:</p>

<table>
  <thead>
    <tr>
      <th>tool_id</th>
      <th>tool_version</th>
      <th>destination_id</th>
      <th>handler</th>
      <th>state</th>
      <th>job_runner_name</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>toolshed.g2.bx.psu.edu/repos/iuc/unicycler/unicycler/0.4.6.0</td>
      <td>0.4.6.0</td>
      <td>12cores_180G_special</td>
      <td>handler_main_4</td>
      <td>running</td>
      <td>condor</td>
      <td>1</td>
    </tr>
    <tr>
      <td>toolshed.g2.bx.psu.edu/repos/iuc/unicycler/unicycler/0.4.6.0</td>
      <td>0.4.6.0</td>
      <td>12cores_180G_special</td>
      <td>handler_main_5</td>
      <td>running</td>
      <td>condor</td>
      <td>1</td>
    </tr>
    <tr>
      <td>toolshed.g2.bx.psu.edu/repos/devteam/freebayes/freebayes/1.1.0.46-0</td>
      <td>1.1.0.46-0</td>
      <td>12cores_12G</td>
      <td>handler_main_3</td>
      <td>running</td>
      <td>condor</td>
      <td>2</td>
    </tr>
    <tr>
      <td>toolshed.g2.bx.psu.edu/repos/iuc/qiime_extract_barcodes/qiime_extract_barcodes/1.9.1.0</td>
      <td>1.9.1.0</td>
      <td>4G_memory</td>
      <td>handler_main_1</td>
      <td>running</td>
      <td>condor</td>
      <td>1</td>
    </tr>
    <tr>
      <td>toolshed.g2.bx.psu.edu/repos/iuc/hisat2/hisat2/2.1.0+galaxy3</td>
      <td>2.1.0+galaxy3</td>
      <td>8cores_20G</td>
      <td>handler_main_11</td>
      <td>running</td>
      <td>condor</td>
      <td>1</td>
    </tr>
    <tr>
      <td>toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.72</td>
      <td>0.72</td>
      <td>20G_memory</td>
      <td>handler_main_11</td>
      <td>running</td>
      <td>condor</td>
      <td>4</td>
    </tr>
    <tr>
      <td>ebi_sra_main</td>
      <td>1.0.1</td>
      <td>4G_memory</td>
      <td>handler_main_3</td>
      <td>running</td>
      <td>condor</td>
      <td>2</td>
    </tr>
    <tr>
      <td>ebi_sra_main</td>
      <td>1.0.1</td>
      <td>4G_memory</td>
      <td>handler_main_4</td>
      <td>running</td>
      <td>condor</td>
      <td>3</td>
    </tr>
  </tbody>
</table>

<p>The <code class="highlighter-rouge">gxadmin iquery queue-overview</code> is run by our Telegraf monitor on a regular basis, allowing us to consume the data:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>queue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/iuc/unicycler/unicycler/0.4.6.0,tool_version=0.4.6.0,state=running,handler=handler_main_4,destination_id=12cores_180G_special,job_runner_name=condor count=1
queue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/iuc/unicycler/unicycler/0.4.6.0,tool_version=0.4.6.0,state=running,handler=handler_main_5,destination_id=12cores_180G_special,job_runner_name=condor count=1
queue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/devteam/freebayes/freebayes/1.1.0.46-0,tool_version=1.1.0.46-0,state=running,handler=handler_main_3,destination_id=12cores_12G,job_runner_name=condor count=1
queue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/devteam/vcffilter/vcffilter2/1.0.0_rc1+galaxy1,tool_version=1.0.0_rc1+galaxy1,state=queued,handler=handler_main_11,destination_id=4G_memory,job_runner_name=condor count=1
queue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/iuc/hisat2/hisat2/2.1.0+galaxy3,tool_version=2.1.0+galaxy3,state=running,handler=handler_main_11,destination_id=8cores_20G,job_runner_name=condor count=1
queue-overview,tool_id=toolshed.g2.bx.psu.edu/repos/devteam/fastqc/fastqc/0.72,tool_version=0.72,state=running,handler=handler_main_11,destination_id=20G_memory,job_runner_name=condor count=4
queue-overview,tool_id=ebi_sra_main,tool_version=1.0.1,state=running,handler=handler_main_3,destination_id=4G_memory,job_runner_name=condor count=2
queue-overview,tool_id=ebi_sra_main,tool_version=1.0.1,state=running,handler=handler_main_4,destination_id=4G_memory,job_runner_name=condor count=3
</code></pre></div></div>

<p>And produce <a href="https://stats.galaxyproject.eu/">some nice graphs</a> from it.</p>

<p>You can use an influx configuration like:</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[[inputs.exec]]</span>
    <span class="py">commands</span> <span class="p">=</span> <span class="nn">["/usr/bin/galaxy-queue-size"]</span>
    <span class="py">timeout</span> <span class="p">=</span> <span class="s">"10s"</span>
    <span class="py">data_format</span> <span class="p">=</span> <span class="s">"influx"</span>
    <span class="py">interval</span> <span class="p">=</span> <span class="s">"1m"</span>
</code></pre></div></div>

<p>This often requires a wrapper script, because you’ll need to pass environment variables to the <code class="highlighter-rouge">gxadmin</code> invocation, e.g.:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">export </span><span class="nv">PGUSER</span><span class="o">=</span>galaxy
<span class="nb">export </span><span class="nv">PGHOST</span><span class="o">=</span>dbhost
gxadmin iquery queue-overview <span class="nt">--short-tool-id</span>
gxadmin iquery workflow-invocation-status
</code></pre></div></div>

<h1 id="implementing-a-query">Implementing a Query</h1>

<p>Queries are really easy to implement! All you have to do is add your SQL, with a small bash function to wrap it. <code class="highlighter-rouge">gxadmin</code> supports ‘local’ functions, which you can add locally without contributing back. We strongly encourage you to contribute your functions back to <code class="highlighter-rouge">gxadmin</code> though, you’ll never know who wants to know the same thing about their db.</p>

<p><code class="highlighter-rouge">gxadmin</code> will look for local functions in <code class="highlighter-rouge">~/.config/gxadmin-local.sh</code></p>

<h2 id="a-basic-function">A basic function</h2>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-implementing-a-basic-function"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Implementing a basic function</h3>

  <ol>
    <li>
      <p>If <code class="highlighter-rouge">~/.config/</code> does not exist, create that directory with <code class="highlighter-rouge">mkdir -p ~/.config/</code></p>
    </li>
    <li>
      <p>Open <code class="highlighter-rouge">~/.config/gxadmin-local.sh</code> in a text editor.</p>
    </li>
    <li>
      <p>Add the following to the file and save it.</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>local_hello<span class="o">()</span> <span class="o">{</span> <span class="c">## hello: Says hi</span>
	<span class="nb">echo</span> <span class="s2">"hi!"</span>
<span class="o">}</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run <code class="highlighter-rouge">gxadmin local</code></p>

      <blockquote class="question">
        <h3 id="question-question"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>What do you see?</p>

        <blockquote class="solution">
          <h3 id="solution-solution"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>It should look like:</p>

          <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">gxadmin usage:

Local: (These can be configured in /home/hxr/.config/gxadmin-local.sh)

    local hello          Says hi

help / -h / --help : this message. Invoke '--help' on any subcommand for help specific to that subcommand
</span></code></pre></div>          </div>

        </blockquote>

      </blockquote>
    </li>
    <li>
      <p>Run <code class="highlighter-rouge">gxadmin local hello</code></p>

      <blockquote class="question">
        <h3 id="question-question-1"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>What do you see?</p>

        <blockquote class="solution">
          <h3 id="solution-solution-1"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>It should output ‘hi!’</p>
        </blockquote>

      </blockquote>
    </li>
  </ol>
</blockquote>

<p>This is the simplest possible function you can add, and is pretty limited in its functionality. This can offer you a nice place to put all of your existing bash scripts, and have autogenerated help for them.</p>

<h2 id="adding-help">Adding help</h2>

<p>Every function is improved by documentation! Let’s add that now:</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-adding-help"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Adding help</h3>

  <ol>
    <li>
      <p>Open <code class="highlighter-rouge">~/.config/gxadmin-local.sh</code> in a text editor.</p>
    </li>
    <li>
      <p>Update your function to add the <code class="highlighter-rouge">handle_help</code> call:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>local_hello<span class="o">()</span> <span class="o">{</span> <span class="c">## hello: Says hi</span>
	handle_help <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
		Greets you
</span><span class="no">	EOF
</span>	<span class="nb">echo</span> <span class="s2">"hi!"</span>
<span class="o">}</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run <code class="highlighter-rouge">gxadmin local hello --help</code></p>

      <blockquote class="question">
        <h3 id="question-question-2"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>What do you see?</p>

        <blockquote class="solution">
          <h3 id="solution-solution-2"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>It should look like:</p>

          <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> gxadmin <span class="nb">local </span>hello <span class="nt">--help</span>
<span class="go">**NAME**

local hello - Says hi

**SYNOPSIS**

gxadmin local hello

**NOTES**

Greets you
</span></code></pre></div>          </div>

        </blockquote>

      </blockquote>
    </li>
  </ol>

</blockquote>

<h2 id="adding-a-query">Adding a query</h2>

<p>The bulk of gxadmin is not fnuctions calling shell commands though, it’s mostly SQL queries. So let’s find the N most recent jobs</p>

<blockquote class="notranslate hands_on">
  <h3 id="hands_on-hands-on-adding-a-query"><i class="fa fa-pencil" aria-hidden="true"></i><span class="visually-hidden">hands_on</span> Hands-on: Adding a query</h3>

  <ol>
    <li>
      <p>Open <code class="highlighter-rouge">~/.config/gxadmin-local.sh</code> in a text editor.</p>
    </li>
    <li>
      <p>Add a new function:</p>

      <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>local_query-latest<span class="o">()</span> <span class="o">{</span> <span class="c">## query-latest [jobs|10]: Queries latest N jobs (default to 10)</span>
	handle_help <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
		Find information about the latest jobs on your server.
</span><span class="no">	EOF

</span>	<span class="c"># Value of first argument, or 10 if isn't supplied</span>
	<span class="nv">job_limit</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">10</span><span class="k">}</span>

	<span class="c"># Here we store the query in a bash variable named QUERY</span>
	<span class="nb">read</span> <span class="nt">-r</span> <span class="nt">-d</span> <span class="s1">''</span> QUERY <span class="o">&lt;&lt;-</span><span class="no">EOF</span><span class="sh">
		SELECT
			id, tool_id, tool_version, state
		FROM job
		ORDER BY id desc
		LIMIT </span><span class="k">${</span><span class="nv">job_limit</span><span class="k">}</span><span class="sh">
</span><span class="no">	EOF
</span><span class="o">}</span>
</code></pre></div>      </div>
    </li>
    <li>
      <p>Run <code class="highlighter-rouge">gxadmin local query-latest 5</code> to select</p>

      <blockquote class="question">
        <h3 id="question-question-3"><i class="fa fa-question-circle" aria-hidden="true"></i><span class="visually-hidden">question</span> Question</h3>

        <p>What do you see?</p>

        <blockquote class="solution">
          <h3 id="solution-solution-3"><i class="fa fa-eye" aria-hidden="true"></i><span class="visually-hidden">solution</span> Solution</h3>
          <p>It should similar to the following, assuming you’ve run tools in your Galaxy</p>

          <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> gxadmin <span class="nb">local </span>query-latest 5
<span class="go"> id  |         tool_id          | tool_version | state
-----+--------------------------+--------------+-------
 103 | upload1                  | 1.1.6        | ok
 102 | upload1                  | 1.1.6        | ok
 101 | upload1                  | 1.1.6        | error
 100 | circos                   | 0.91         | ok
  99 | circos                   | 0.91         | ok
(5 rows)
</span></code></pre></div>          </div>

        </blockquote>

      </blockquote>
    </li>
  </ol>

</blockquote>

<h1 id="summary">Summary</h1>

<p>There are a lot of queries, all tailored to specific use cases, some of these may be interesting for you, some may not. These are <a href="https://github.com/usegalaxy-eu/gxadmin#commands">all documented</a> with example inputs and outputs in the gxadmin readme, and help is likewise available from the command line.</p>



                    
                    <blockquote class="key_points">
                        <h3><i class="fa fa-key" aria-hidden="true"></i><span class="visually-hidden">keypoints</span> Key points</h3>

                        <ul>
                            
                            <li>gxadmin is a tool to run common database queries useful for Galaxy admins</li>
                            
                            <li>new queries are welcome and easy to contribute</li>
                            
                        </ul>
                    </blockquote>
                    

                    

                    

                </div>
            </div>
        </div>

        <h3><i class="fa fa-thumbs-up" aria-hidden="true"></i><span class="visually-hidden">congratulations</span> Congratulations on successfully completing this tutorial!</h3>

        

        

        <hr>
        <br>

        <iframe id="feedback-google" class="google-form" src="https://docs.google.com/forms/d/e/1FAIpQLSd4VZptFTQ03kHkMz0JyW9b6_S8geU5KjNE_tLM0dixT3ZQmA/viewform?embedded=true&entry.1235803833=Galaxy Monitoring with gxadmin (Galaxy Server administration)">Loading...
        </iframe>

        <blockquote class="feedback">
            <h3><i class="fa fa-comments-o" aria-hidden="true"></i><span class="visually-hidden">feedback</span> Give us even more feedback on this content!</h3>
            <p>To give us more detailed feedback about these materials, please take a moment to fill in the extended <a href="https://docs.google.com/forms/d/e/1FAIpQLSc_GLZRpxZGAL9tN6DA1bE6WkNhmQdXT7B16TpOb-X4YwKUsQ/viewform?entry.1548889262=Galaxy Monitoring with gxadmin (Galaxy Server administration)">Feedback Form</a>.</p>
        </blockquote>
    </section>
</div>


<footer>
    <div class="container">
        <p>
            This material is the result of a collaborative work. Thanks to the
            <a href="https://wiki.galaxyproject.org/Teach/GTN">Galaxy Training Network</a>
            and all the <a href="/training-material/hall-of-fame">contributors</a> (Helena Rasche)!
        </p>
        <p>
            Found a typo? Something is wrong in this tutorial? Edit it on
            <a href="https://github.com/galaxyproject/training-material/tree/master/topics/admin/tutorials/gxadmin/tutorial.md">GitHub</a>.
        </p>
    </div>
</footer>

    </body>
    <script type="text/javascript" src="/training-material/assets/js/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/popper.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap.min.js?v=3"></script>
    <script type="text/javascript" src="/training-material/assets/js/details-element-polyfill.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="/training-material/assets/js/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="/training-material/assets/js/main.js"></script>

    <script type="text/javascript" src="/training-material/assets/js/clipboard.min.js"></script>
    <script type="text/javascript">
    var snippets=document.querySelectorAll('div.highlight');
    [].forEach.call(snippets,function(snippet){
        snippet.firstChild.insertAdjacentHTML('beforebegin','<button class="btn btn-light" data-clipboard-snippet><i class="fa fa-copy"></i>&nbsp;Copy</button>');
    });

    var clipboardSnippets=new ClipboardJS('[data-clipboard-snippet]',{
        target:function(trigger){return trigger.nextElementSibling;
    }});
    </script>
</html>
